import base64; exec(base64.b64decode('aW1wb3J0IGRpc2NvcmQKZnJvbSBkaXNjb3JkIGltcG9ydCBhcHBfY29tbWFuZHMKZnJvbSBkaXNjb3JkLmV4dCBpbXBvcnQgY29tbWFuZHMKaW1wb3J0IGpzb24KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YSwgdGltZXpvbmUKaW1wb3J0IG9zCmltcG9ydCBhc3luY2lvCmltcG9ydCBpbwp3aXRoIG9wZW4oJ2NvbmZpZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgY29uZmlnID0ganNvbi5sb2FkKGYpClRPS0VOID0gY29uZmlnWydib3RfdG9rZW4nXQpHVUlMRF9JRCA9IGNvbmZpZ1snZ3VpbGRfaWQnXQpURUFNX1JPTEVfSURTID0gY29uZmlnWyd0ZWFtX3JvbGVfaWQnXQpBRE1JTl9ST0xFX0lEUyA9IGNvbmZpZ1snYWRtaW5fcm9sZV9pZCddCldBUk5fUk9MRVMgPSBjb25maWdbJ3dhcm5fcm9sZXMnXQpXQVJOX0ZJTEUgPSAnd2FybnMuanNvbicKSElTVE9SWV9GSUxFID0gJ21lbWJlcl9oaXN0b3J5Lmpzb24nCmludGVudHMgPSBkaXNjb3JkLkludGVudHMuYWxsKCkKYm90ID0gY29tbWFuZHMuQm90KGNvbW1hbmRfcHJlZml4PScvJywgaW50ZW50cz1pbnRlbnRzKQpsYXN0X21lc3NhZ2UgPSBOb25lCmxhc3RfY2hhbm5lbCA9IE5vbmUKCmRlZiBpc19mZWF0dXJlX2VuYWJsZWQoZmVhdHVyZTogc3RyKSAtPiBib29sOgogICAgcmV0dXJuIGNvbmZpZ1snZmVhdHVyZXMnXS5nZXQoZmVhdHVyZSwgVHJ1ZSkKCmRlZiBjcmVhdGVfZW1iZWQobmFtZTogc3RyLCAqKmt3YXJncykgLT4gZGlzY29yZC5FbWJlZDoKICAgIHNldHRpbmdzID0gY29uZmlnWydlbWJlZHMnXS5nZXQobmFtZSwge30pCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9c2V0dGluZ3MuZ2V0KCd0aXRsZScsICdLZWluIFRpdGVsJyksIGRlc2NyaXB0aW9uPXNldHRpbmdzLmdldCgnZGVzY3JpcHRpb24nLCAnJykuZm9ybWF0KCoqa3dhcmdzKSwgY29sb3I9ZGlzY29yZC5Db2xvcihzZXR0aW5ncy5nZXQoJ2NvbG9yJywgMzQ0NzAwMykpKQogICAgaWYgJ2F1dGhvcicgaW4gc2V0dGluZ3M6CiAgICAgICAgZW1iZWQuc2V0X2F1dGhvcihuYW1lPXNldHRpbmdzWydhdXRob3InXS5nZXQoJ25hbWUnLCAnJyksIGljb25fdXJsPXNldHRpbmdzWydhdXRob3InXS5nZXQoJ2ljb25fdXJsJywgJycpKQogICAgaWYgJ3RodW1ibmFpbCcgaW4gc2V0dGluZ3M6CiAgICAgICAgZW1iZWQuc2V0X3RodW1ibmFpbCh1cmw9c2V0dGluZ3NbJ3RodW1ibmFpbCddKQogICAgaWYgJ2Zvb3RlcicgaW4gc2V0dGluZ3M6CiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PXNldHRpbmdzWydmb290ZXInXS5nZXQoJ3RleHQnLCAnJyksIGljb25fdXJsPXNldHRpbmdzWydmb290ZXInXS5nZXQoJ2ljb25fdXJsJywgJycpKQogICAgaWYgc2V0dGluZ3MuZ2V0KCd0aW1lc3RhbXAnLCBGYWxzZSk6CiAgICAgICAgZW1iZWQudGltZXN0YW1wID0gZGF0ZXRpbWUubm93KHRpbWV6b25lLnV0YykKICAgIHJldHVybiBlbWJlZAoKZGVmIGxvYWRfd2FybnMoKToKICAgIGlmIG9zLnBhdGguZXhpc3RzKFdBUk5fRklMRSk6CiAgICAgICAgd2l0aCBvcGVuKFdBUk5fRklMRSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpCiAgICByZXR1cm4ge30KCmRlZiBzYXZlX3dhcm5zKCk6CiAgICB3aXRoIG9wZW4oV0FSTl9GSUxFLCAndycpIGFzIGY6CiAgICAgICAganNvbi5kdW1wKHdhcm5zLCBmLCBpbmRlbnQ9NCkKd2FybnMgPSBsb2FkX3dhcm5zKCkKCmRlZiBsb2FkX2hpc3RvcnkoKToKICAgIGlmIG9zLnBhdGguZXhpc3RzKEhJU1RPUllfRklMRSk6CiAgICAgICAgd2l0aCBvcGVuKEhJU1RPUllfRklMRSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpCiAgICByZXR1cm4ge30KCmRlZiBzYXZlX2hpc3RvcnkoaGlzdG9yeSk6CiAgICB3aXRoIG9wZW4oSElTVE9SWV9GSUxFLCAndycpIGFzIGY6CiAgICAgICAganNvbi5kdW1wKGhpc3RvcnksIGYsIGluZGVudD00KQoKZGVmIHVwZGF0ZV9oaXN0b3J5KG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIGFjdGlvbjogc3RyLCBkZXRhaWxzOiBzdHIpOgogICAgdXNlcl9pZCA9IHN0cihtZW1iZXIuaWQpCiAgICBpZiB1c2VyX2lkIG5vdCBpbiBoaXN0b3J5OgogICAgICAgIGhpc3RvcnlbdXNlcl9pZF0gPSB7J2pvaW5lZF9hdCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpLCAnbGFzdF91cHJhbmsnOiAnTi9BJywgJ3dhcm5zJzogW10sICdsYXN0X3dhcm5fZXhwaXJlZCc6ICdOL0EnLCAnZnVsbF9oaXN0b3J5JzogW119CiAgICBpZiBhY3Rpb24gPT0gJ1VwcmFuayc6CiAgICAgICAgaGlzdG9yeVt1c2VyX2lkXVsnbGFzdF91cHJhbmsnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICBlbGlmIGFjdGlvbiA9PSAnV2FybicgYW5kICdleHBpcmVkJyBpbiBkZXRhaWxzLmxvd2VyKCk6CiAgICAgICAgaGlzdG9yeVt1c2VyX2lkXVsnbGFzdF93YXJuX2V4cGlyZWQnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICBoaXN0b3J5W3VzZXJfaWRdWydmdWxsX2hpc3RvcnknXS5hcHBlbmQoZiJbe2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpfV0ge2FjdGlvbn06IHtkZXRhaWxzfSIpCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkKaGlzdG9yeSA9IGxvYWRfaGlzdG9yeSgpCgpAYm90LmV2ZW50CkBib3QuZXZlbnQKYXN5bmMgZGVmIG9uX3JlYWR5KCk6CiAgICBwcmludChmJ0JvdCBpc3Qgb25saW5lOiB7Ym90LnVzZXJ9IScpCiAgICBwcmludCgnU2xhc2gtQ29tbWFuZHMgd2VyZGVuIHN5bmNocm9uaXNpZXJ0Li4uJykKICAgIHRyeToKICAgICAgICBndWlsZCA9IGRpc2NvcmQuT2JqZWN0KGlkPUdVSUxEX0lEKQogICAgICAgIGF3YWl0IGJvdC50cmVlLnN5bmMoKQogICAgICAgIGJvdC50cmVlLmNvcHlfZ2xvYmFsX3RvKGd1aWxkPWd1aWxkKQogICAgICAgIHN5bmNlZCA9IGF3YWl0IGJvdC50cmVlLnN5bmMoZ3VpbGQ9Z3VpbGQpCiAgICAgICAgcHJpbnQoZidTeW5jZWQge2xlbihzeW5jZWQpfSBjb21tYW5kcyBmb3IgZ3VpbGQge0dVSUxEX0lEfScpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZidGZWhsZXIgYmVpbSBTeW5jaHJvbmlzaWVyZW46IHtlfScpCgphc3luYyBkZWYgc2VuZF9kbShtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCB0aXRsZTogc3RyLCBkZXNjcmlwdGlvbjogc3RyLCBpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbik6CiAgICB0cnk6CiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPXRpdGxlLCBkZXNjcmlwdGlvbj1kZXNjcmlwdGlvbiwgY29sb3I9ZGlzY29yZC5Db2xvci5ibHVlKCkpCiAgICAgICAgaWYgaW50ZXJhY3Rpb24uY2hhbm5lbDoKICAgICAgICAgICAgbGFzdF9tZXNzYWdlID0gYXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbC5zZW5kKCcuJykKICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J01laHIgSW5mb3MnLCB2YWx1ZT1mJ1tOYWNocmljaHQgYW56ZWlnZW5dKGh0dHBzOi8vZGlzY29yZC5jb20vY2hhbm5lbHMve2ludGVyYWN0aW9uLmd1aWxkLmlkfS97aW50ZXJhY3Rpb24uY2hhbm5lbC5pZH0ve2xhc3RfbWVzc2FnZS5pZH0pJykKICAgICAgICAgICAgYXdhaXQgbGFzdF9tZXNzYWdlLmRlbGV0ZSgpCiAgICAgICAgYXdhaXQgbWVtYmVyLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgcHJpbnQoZidbV0FSTlVOR10gS29ubnRlIHttZW1iZXJ9IGtlaW5lIERNIHNlbmRlbiAoRE1zIG3DtmdsaWNoZXJ3ZWlzZSBkZWFrdGl2aWVydCkuJykKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3RlYW1saXN0ZScsIGRlc2NyaXB0aW9uPSdaZWlndCBkaWUgVGVhbW1pdGdsaWVkZXIgdW5kIGlocmUgUm9sbGVuLicpCmFzeW5jIGRlZiB0ZWFtbGlzdGUoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24pOgogICAgaWYgbm90IGlzX2ZlYXR1cmVfZW5hYmxlZCgndGVhbWxpc3RlJyk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERpZSBUZWFtbGlzdGUgd2lyZCBha3R1YWxpc2llcnQhJywgZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCB1cGRhdGVfdGVhbWxpc3RlKGludGVyYWN0aW9uLmNoYW5uZWwpCgphc3luYyBkZWYgdXBkYXRlX3RlYW1saXN0ZShjaGFubmVsKToKICAgIGdsb2JhbCBsYXN0X21lc3NhZ2UsIGxhc3RfY2hhbm5lbAogICAgZ3VpbGQgPSBjaGFubmVsLmd1aWxkCiAgICB0ZWFtX3JvbGVzID0ge3JvbGUuaWQ6IHJvbGUgZm9yIHJvbGUgaW4gZ3VpbGQucm9sZXMgaWYgcm9sZS5pZCBpbiBURUFNX1JPTEVfSURTfQogICAgdGVhbV9tZW1iZXJzID0ge3JvbGU6IFtdIGZvciByb2xlIGluIHRlYW1fcm9sZXMudmFsdWVzKCl9CiAgICBmb3IgbWVtYmVyIGluIGd1aWxkLm1lbWJlcnM6CiAgICAgICAgZm9yIHJvbGUgaW4gbWVtYmVyLnJvbGVzOgogICAgICAgICAgICBpZiByb2xlLmlkIGluIHRlYW1fcm9sZXM6CiAgICAgICAgICAgICAgICB0ZWFtX21lbWJlcnNbdGVhbV9yb2xlc1tyb2xlLmlkXV0uYXBwZW5kKG1lbWJlci5tZW50aW9uKQogICAgZGVzY3JpcHRpb24gPSAnJwogICAgZm9yIChyb2xlLCBtZW1iZXJzKSBpbiB0ZWFtX21lbWJlcnMuaXRlbXMoKToKICAgICAgICByb2xlX21lbnRpb24gPSByb2xlLm1lbnRpb24KICAgICAgICBtZW1iZXJzX2xpc3QgPSAnXG4nLmpvaW4obWVtYmVycykgaWYgbWVtYmVycyBlbHNlICdLZWluZSBNaXRnbGllZGVyJwogICAgICAgIGRlc2NyaXB0aW9uICs9IGYnKip7cm9sZV9tZW50aW9ufSoqICh7bGVuKG1lbWJlcnMpfSBNaXRnbGllZGVyKVxue21lbWJlcnNfbGlzdH1cblxuJwogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoJ3RlYW1saXN0ZScpCiAgICBlbWJlZC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uCiAgICB0ZWFtbGlzdGVfc2V0dGluZ3MgPSBjb25maWdbJ2VtYmVkcyddLmdldCgndGVhbWxpc3RlJywge30pCiAgICBpbWFnZV91cmwgPSB0ZWFtbGlzdGVfc2V0dGluZ3MuZ2V0KCdpbWFnZScpCiAgICBpZiBpbWFnZV91cmw6CiAgICAgICAgZW1iZWQuc2V0X2ltYWdlKHVybD1pbWFnZV91cmwpCiAgICBpZiBsYXN0X21lc3NhZ2U6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCBsYXN0X21lc3NhZ2UuZGVsZXRlKCkKICAgICAgICBleGNlcHQgZGlzY29yZC5Ob3RGb3VuZDoKICAgICAgICAgICAgcHJpbnQoJ1tERUJVR10gQWx0ZSBOYWNocmljaHQgbmljaHQgZ2VmdW5kZW4gKHZpZWxsZWljaHQgYmVyZWl0cyBnZWzDtnNjaHQpLicpCiAgICAgICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgICAgICBwcmludCgnW0RFQlVHXSBCb3QgaGF0IGtlaW5lIEJlcmVjaHRpZ3VuZywgZGllIE5hY2hyaWNodCB6dSBsw7ZzY2hlbi4nKQogICAgbGFzdF9tZXNzYWdlID0gYXdhaXQgY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQogICAgbGFzdF9jaGFubmVsID0gY2hhbm5lbAoKQGJvdC5ldmVudAphc3luYyBkZWYgb25fbWVtYmVyX3VwZGF0ZShiZWZvcmU6IGRpc2NvcmQuTWVtYmVyLCBhZnRlcjogZGlzY29yZC5NZW1iZXIpOgogICAgYWRkZWRfcm9sZXMgPSBbcm9sZSBmb3Igcm9sZSBpbiBhZnRlci5yb2xlcyBpZiByb2xlIG5vdCBpbiBiZWZvcmUucm9sZXNdCiAgICByZW1vdmVkX3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gYmVmb3JlLnJvbGVzIGlmIHJvbGUgbm90IGluIGFmdGVyLnJvbGVzXQogICAgcmVsZXZhbnRfcm9sZXMgPSBbcm9sZSBmb3Igcm9sZSBpbiBhZGRlZF9yb2xlcyArIHJlbW92ZWRfcm9sZXMgaWYgcm9sZS5pZCBpbiBURUFNX1JPTEVfSURTXQogICAgaWYgcmVsZXZhbnRfcm9sZXMgYW5kIGxhc3RfY2hhbm5lbDoKICAgICAgICBhd2FpdCB1cGRhdGVfdGVhbWxpc3RlKGxhc3RfY2hhbm5lbCkKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3RlYW1iZWl0cml0dCcsIGRlc2NyaXB0aW9uPSdGw7xndCBlaW5lbiBVc2VyIGluIGRhcyBUZWFtIGVpbi4nKQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0nRGFzIE1pdGdsaWVkLCBkYXMgYmVpdHJldGVuIHNvbGwuJywgcm9sZT0nRGllIHNwZXppZWxsZSBUZWFtcm9sbGUsIGRpZSB6dWdld2llc2VuIHdpcmQuJykKYXN5bmMgZGVmIHRlYW1iZWl0cml0dChpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcm9sZTogZGlzY29yZC5Sb2xlKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ3RlYW1iZWl0cml0dCcpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgcm9sZS5pZCBub3QgaW4gVEVBTV9ST0xFX0lEUzoKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgUm9sbGUgaXN0IGtlaW5lIGfDvGx0aWdlIFRlYW1yb2xsZS4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHN0YW5kYXJkX3RlYW1fcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1URUFNX1JPTEVfSURTWzBdKQogICAgaWYgbm90IHN0YW5kYXJkX3RlYW1fcm9sZToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgU3RhbmRhcmQtVGVhbXJvbGxlIHd1cmRlIG5pY2h0IGdlZnVuZGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhzdGFuZGFyZF90ZWFtX3JvbGUsIHJvbGUpCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndGVhbWJlaXRyaXR0JywgbWVtYmVyPW1lbWJlci5tZW50aW9uLCByb2xlPXJvbGUubWVudGlvbiwgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLCBhZG1pbl9yb2xlcz0nLCAnLmpvaW4oKGYnPEAme3JvbGVfaWR9PicgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpKSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERlciBCZWl0cml0dCB3dXJkZSBlcmZvbGdyZWljaCB2ZXJhcmJlaXRldCEnLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIGF3YWl0IHNlbmRfZG0obWVtYmVyLCAnVGVhbWJlaXRyaXR0JywgZidXaWxsa29tbWVuIGltIFRlYW0gYWxzIHtyb2xlLm5hbWV9LiBXaXIgZnJldWVuIHVucyBhdWYgZGljaC4nLCBpbnRlcmFjdGlvbikKICAgIHVwZGF0ZV9oaXN0b3J5KG1lbWJlciwgJ1RlYW1iZWl0cml0dCcsIGYnQmVpZ2V0cmV0ZW4gbWl0IFJvbGxlIHtyb2xlLm5hbWV9IHwgRWluZ2VsYWRlbiB2b246IHtpbnRlcmFjdGlvbi51c2VyLmRpc3BsYXlfbmFtZX0nKQoKQGJvdC50cmVlLmNvbW1hbmQobmFtZT0ndXByYW5rJywgZGVzY3JpcHRpb249J0JlZsO2cmRlcnQgZWluIFRlYW1taXRnbGllZC4nKQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0nRGFzIE1pdGdsaWVkLCBkYXMgYmVmw7ZyZGVydCB3aXJkLicsIG9sZF9yb2xlPSdBbHRlIFJvbGxlJywgbmV3X3JvbGU9J05ldWUgUm9sbGUnKQphc3luYyBkZWYgdXByYW5rKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCBvbGRfcm9sZTogZGlzY29yZC5Sb2xlLCBuZXdfcm9sZTogZGlzY29yZC5Sb2xlKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ3VwcmFuaycpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgb2xkX3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFMgb3IgbmV3X3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFM6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEVpbmUgZGVyIFJvbGxlbiBpc3Qga2VpbmUgZ8O8bHRpZ2UgVGVhbXJvbGxlLicsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhvbGRfcm9sZSkKICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMobmV3X3JvbGUpCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndXByYW5rJywgbWVtYmVyPW1lbWJlci5tZW50aW9uLCBvbGRfcm9sZT1vbGRfcm9sZS5tZW50aW9uLCBuZXdfcm9sZT1uZXdfcm9sZS5tZW50aW9uLCBhZG1pbj1pbnRlcmFjdGlvbi51c2VyLm1lbnRpb24sIGFkbWluX3JvbGVzPScsICcuam9pbigoZic8QCZ7cm9sZV9pZH0+JyBmb3Igcm9sZV9pZCBpbiBBRE1JTl9ST0xFX0lEUykpKQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinIUgRGVyIFVwcmFuayB3dXJkZSBlcmZvbGdyZWljaCBkdXJjaGdlZsO8aHJ0IScsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQogICAgYXdhaXQgc2VuZF9kbShtZW1iZXIsICdVcHJhbmsnLCBmJ0R1IGhhc3QgZWluICoqVXByYW5rKiogdm9uIHtvbGRfcm9sZS5uYW1lfSB6dSB7bmV3X3JvbGUubmFtZX0gZXJoYWx0ZW4uJywgaW50ZXJhY3Rpb24pCiAgICBoaXN0b3J5W3N0cihtZW1iZXIuaWQpXVsnbGFzdF91cHJhbmsnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICB1cGRhdGVfaGlzdG9yeShtZW1iZXIsICdVcHJhbmsnLCBmJ0JlZsO2cmRlcnQgdm9uIHtvbGRfcm9sZS5uYW1lfSB6dSB7bmV3X3JvbGUubmFtZX0gfCBEdXJjaDoge2ludGVyYWN0aW9uLnVzZXIuZGlzcGxheV9uYW1lfScpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSdkZXJhbmsnLCBkZXNjcmlwdGlvbj0nU2V0enQgZGllIFRlYW1yb2xsZSBlaW5lcyBNaXRnbGllZHMgaGVyYWIuJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGRlZ3JhZGllcnQgd2lyZC4nLCBvbGRfcm9sZT0nRGllIHZvcmhlcmlnZSBSb2xsZS4nLCBuZXdfcm9sZT0nRGllIG5ldWUgUm9sbGUuJywgcmVhc29uPSdEZXIgR3J1bmQgZsO8ciBkZW4gRGVyYW5rLicpCmFzeW5jIGRlZiBkZXJhbmsoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24sIG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIG9sZF9yb2xlOiBkaXNjb3JkLlJvbGUsIG5ld19yb2xlOiBkaXNjb3JkLlJvbGUsIHJlYXNvbjogc3RyKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ2RlcmFuaycpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgb2xkX3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFMgb3IgbmV3X3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFM6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEVpbmUgb2RlciBiZWlkZSBSb2xsZW4gc2luZCBrZWluZSBnw7xsdGlnZW4gVGVhbXJvbGxlbi4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHRyeToKICAgICAgICBhd2FpdCBtZW1iZXIucmVtb3ZlX3JvbGVzKG9sZF9yb2xlKQogICAgICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMobmV3X3JvbGUpCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEJvdCBoYXQga2VpbmUgQmVyZWNodGlndW5nLCBSb2xsZW4genUgdmVyd2FsdGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgZXhjZXB0IGRpc2NvcmQuSFRUUEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRmVobGVyIGJlaW0gQWt0dWFsaXNpZXJlbiBkZXIgUm9sbGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoJ2RlcmFuaycsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgb2xkX3JvbGU9b2xkX3JvbGUubWVudGlvbiwgbmV3X3JvbGU9bmV3X3JvbGUubWVudGlvbiwgcmVhc29uPXJlYXNvbiwgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLCBhZG1pbl9yb2xlcz0nLCAnLmpvaW4oKGYnPEAme3JvbGVfaWR9PicgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpKSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERlciBEZXJhbmsgd3VyZGUgZXJmb2xncmVpY2ggZHVyY2hnZWbDvGhydCEnLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIHRyeToKICAgICAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgJ0RlcmFuaycsIGYnRHUgaGFzdCBlaW4gKipEZXJhbmsqKiB2b24ge29sZF9yb2xlLm5hbWV9IHp1IHtuZXdfcm9sZS5uYW1lfSBlcmhhbHRlbi5cblxuKipHcnVuZDoqKiB7cmVhc29ufScsIGludGVyYWN0aW9uKQogICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgIHByaW50KGYnW1dBUk5VTkddIEtvbm50ZSB7bWVtYmVyfSBrZWluZSBETSBzZW5kZW4gKERNcyBtw7ZnbGljaGVyd2Vpc2UgZGVha3RpdmllcnQpLicpCiAgICBpZiBzdHIobWVtYmVyLmlkKSBub3QgaW4gaGlzdG9yeToKICAgICAgICBoaXN0b3J5W3N0cihtZW1iZXIuaWQpXSA9IHsnam9pbmVkX2F0JzogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyksICdsYXN0X3VwcmFuayc6ICdOL0EnLCAnd2FybnMnOiBbXSwgJ2xhc3Rfd2Fybl9leHBpcmVkJzogJ04vQScsICdmdWxsX2hpc3RvcnknOiBbXX0KICAgIGhpc3Rvcnlbc3RyKG1lbWJlci5pZCldWydmdWxsX2hpc3RvcnknXS5hcHBlbmQoZiJbe2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpfV0gRGVyYW5rOiBWb24ge29sZF9yb2xlLm5hbWV9IHp1IHtuZXdfcm9sZS5uYW1lfSBkdXJjaCB7aW50ZXJhY3Rpb24udXNlci5kaXNwbGF5X25hbWV9LCBHcnVuZDoge3JlYXNvbn0iKQogICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSd0ZWFtd2FybicsIGRlc2NyaXB0aW9uPSdHaWJ0IGVpbmVtIFRlYW1taXRnbGllZCBlaW5lIFdhcm51bmcuJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGdld2FybnQgd2lyZC4nLCByZWFzb249J0dydW5kIGbDvHIgZGllIFdhcm51bmcuJywgZHVyYXRpb249J0RhdWVyIGluIFNla3VuZGVuJykKYXN5bmMgZGVmIHRlYW13YXJuKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCByZWFzb246IHN0ciwgZHVyYXRpb246IGludCk6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCd0ZWFtd2FybicpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgd2Fybl9pZCA9IHN0cihpbnQoZGF0ZXRpbWUubm93KCkudGltZXN0YW1wKCkpKSArIHN0cihtZW1iZXIuaWQpCiAgICB1c2VyX2lkID0gc3RyKG1lbWJlci5pZCkKICAgIGlmIHVzZXJfaWQgbm90IGluIHdhcm5zOgogICAgICAgIHdhcm5zW3VzZXJfaWRdID0gW10KICAgIHdhcm5zW3VzZXJfaWRdLmFwcGVuZCh7J2lkJzogd2Fybl9pZCwgJ3JlYXNvbic6IHJlYXNvbiwgJ2V4cGlyZXMnOiAoZGF0ZXRpbWUubm93KCkgKyB0aW1lZGVsdGEoc2Vjb25kcz1kdXJhdGlvbikpLnRpbWVzdGFtcCgpLCAnYWRtaW4nOiBpbnRlcmFjdGlvbi51c2VyLmlkfSkKICAgIHNhdmVfd2FybnMoKQogICAgd2Fybl9jb3VudCA9IGxlbihbdyBmb3IgdyBpbiB3YXJucy5nZXQodXNlcl9pZCwgW10pIGlmIG5vdCB3LmdldCgnZXhwaXJlZCcsIEZhbHNlKV0pCiAgICByb2xlX2luZGV4ID0gKHdhcm5fY291bnQgLSAxKSAlIDMgKyAxCiAgICBmb3Igcm9sZV9pZCBpbiBjb25maWdbJ3dhcm5fcm9sZXMnXS52YWx1ZXMoKToKICAgICAgICByb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPXJvbGVfaWQpCiAgICAgICAgaWYgcm9sZSBhbmQgcm9sZSBpbiBtZW1iZXIucm9sZXM6CiAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkKICAgIG5ld19yb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPWNvbmZpZ1snd2Fybl9yb2xlcyddLmdldChzdHIocm9sZV9pbmRleCkpKQogICAgaWYgbmV3X3JvbGU6CiAgICAgICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhuZXdfcm9sZSkKICAgIG5ld19yb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPWNvbmZpZ1snd2Fybl9yb2xlcyddLmdldChzdHIod2Fybl9jb3VudCkpKQogICAgaWYgbmV3X3JvbGU6CiAgICAgICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhuZXdfcm9sZSkKICAgIGVtYmVkID0gY3JlYXRlX2VtYmVkKCd0ZWFtd2FybicsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgcmVhc29uPXJlYXNvbiwgZHVyYXRpb249ZHVyYXRpb24sIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbiwgYWRtaW5fcm9sZXM9JywgJy5qb2luKChmJzxAJntyb2xlX2lkfT4nIGZvciByb2xlX2lkIGluIEFETUlOX1JPTEVfSURTKSkpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5kZWZlcihlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIHRyeToKICAgICAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgJ1RlYW13YXJuJywgZidEdSBoYXN0IGVpbmUgV2FybnVuZyBlcmhhbHRlbi5cbioqR3J1bmQ6Kioge3JlYXNvbn1cbioqRGF1ZXI6Kioge2R1cmF0aW9ufXNcbioqV2Fybi1JRDoqKiB7d2Fybl9pZH0nLCBpbnRlcmFjdGlvbikKICAgIGV4Y2VwdCBkaXNjb3JkLkZvcmJpZGRlbjoKICAgICAgICBwcmludChmJ0tvbm50ZSBETSBhbiB7bWVtYmVyfSBuaWNodCBzZW5kZW4nKQogICAgaWYgdXNlcl9pZCBub3QgaW4gaGlzdG9yeToKICAgICAgICBoaXN0b3J5W3VzZXJfaWRdID0geydqb2luZWRfYXQnOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKSwgJ3dhcm5zJzogW10sICdmdWxsX2hpc3RvcnknOiBbXX0KICAgIGhpc3RvcnlbdXNlcl9pZF1bJ3dhcm5zJ10uYXBwZW5kKHsnaWQnOiB3YXJuX2lkLCAncmVhc29uJzogcmVhc29uLCAnaXNzdWVkJzogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyksICdleHBpcmVzJzogKGRhdGV0aW1lLm5vdygpICsgdGltZWRlbHRhKHNlY29uZHM9ZHVyYXRpb24pKS50aW1lc3RhbXAoKSwgJ2FkbWluJzogaW50ZXJhY3Rpb24udXNlci5pZCwgJ2V4cGlyZWQnOiBGYWxzZX0pCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkKCiAgICBhc3luYyBkZWYgZXhwaXJlX3dhcm4oKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoZHVyYXRpb24pCiAgICAgICAgICAgIGlmIHVzZXJfaWQgbm90IGluIHdhcm5zOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHdhcm5fc3RpbGxfYWN0aXZlID0gRmFsc2UKICAgICAgICAgICAgZm9yIHdhcm4gaW4gd2FybnNbdXNlcl9pZF06CiAgICAgICAgICAgICAgICBpZiB3YXJuWydpZCddID09IHdhcm5faWQgYW5kIChub3Qgd2Fybi5nZXQoJ3JlbW92ZWQnLCBGYWxzZSkpOgogICAgICAgICAgICAgICAgICAgIHdhcm5fc3RpbGxfYWN0aXZlID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGlmIG5vdCB3YXJuX3N0aWxsX2FjdGl2ZToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB3YXJuX2xldmVsID0gTm9uZQogICAgICAgICAgICBmb3IgKGksIHdhcm4pIGluIGVudW1lcmF0ZSh3YXJuc1t1c2VyX2lkXSk6CiAgICAgICAgICAgICAgICBpZiB3YXJuWydpZCddID09IHdhcm5faWQ6CiAgICAgICAgICAgICAgICAgICAgd2Fybl9sZXZlbCA9IGkgKyAxCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgaWYgd2Fybl9sZXZlbCBhbmQgd2Fybl9sZXZlbCA8PSAzOgogICAgICAgICAgICAgICAgcm9sZV9pZCA9IGNvbmZpZ1snd2Fybl9yb2xlcyddLmdldChzdHIod2Fybl9sZXZlbCkpCiAgICAgICAgICAgICAgICBpZiByb2xlX2lkOgogICAgICAgICAgICAgICAgICAgIHJvbGUgPSBkaXNjb3JkLnV0aWxzLmdldChpbnRlcmFjdGlvbi5ndWlsZC5yb2xlcywgaWQ9cm9sZV9pZCkKICAgICAgICAgICAgICAgICAgICBpZiByb2xlIGFuZCByb2xlIGluIG1lbWJlci5yb2xlczoKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhyb2xlKQogICAgICAgICAgICBmb3Igd2FybiBpbiB3YXJuc1t1c2VyX2lkXToKICAgICAgICAgICAgICAgIGlmIHdhcm5bJ2lkJ10gPT0gd2Fybl9pZDoKICAgICAgICAgICAgICAgICAgICB3YXJuWydleHBpcmVkJ10gPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgc2F2ZV93YXJucygpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IG1lbWJlci5zZW5kKGVtYmVkPWRpc2NvcmQuRW1iZWQodGl0bGU9J+KchSBXYXJudW5nIGFiZ2VsYXVmZW4nLCBkZXNjcmlwdGlvbj1mJ0RlaW5lIFdhcm51bmcgaXN0IGF1dG9tYXRpc2NoIGFiZ2VsYXVmZW4uXG5cbioqR3J1bmQ6Kioge3JlYXNvbn1cbioqRGF1ZXI6Kioge2R1cmF0aW9ufXNcbioqV2Fybi1JRDoqKiB7d2Fybl9pZH0nLCBjb2xvcj1kaXNjb3JkLkNvbG9yLmdyZWVuKCkpKQogICAgICAgICAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGxvZ19jaGFubmVsX2lkID0gY29uZmlnLmdldCgnd2Fybl9sb2dfY2hhbm5lbCcpCiAgICAgICAgICAgIGlmIGxvZ19jaGFubmVsX2lkOgogICAgICAgICAgICAgICAgbG9nX2NoYW5uZWwgPSBib3QuZ2V0X2NoYW5uZWwobG9nX2NoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICBpZiBsb2dfY2hhbm5lbDoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2dfY2hhbm5lbC5zZW5kKGVtYmVkPWRpc2NvcmQuRW1iZWQodGl0bGU9J+KaoO+4jyBXYXJudW5nIGFiZ2VsYXVmZW4nLCBkZXNjcmlwdGlvbj1mJ1dhcm51bmcgZsO8ciB7bWVtYmVyLm1lbnRpb259IGlzdCBhYmdlbGF1ZmVuJywgY29sb3I9ZGlzY29yZC5Db2xvci5ncmVlbigpLCB0aW1lc3RhbXA9ZGF0ZXRpbWUubm93KCkpLmFkZF9maWVsZChuYW1lPSdHcnVuZCcsIHZhbHVlPXJlYXNvbiwgaW5saW5lPUZhbHNlKS5hZGRfZmllbGQobmFtZT0nRGF1ZXInLCB2YWx1ZT1mJ3tkdXJhdGlvbn0gU2VrdW5kZW4nLCBpbmxpbmU9VHJ1ZSkuYWRkX2ZpZWxkKG5hbWU9J1dhcm4tSUQnLCB2YWx1ZT13YXJuX2lkLCBpbmxpbmU9VHJ1ZSkuc2V0X2Zvb3Rlcih0ZXh0PWYnQXV0b21hdGlzY2ggYWJnZWxhdWZlbicpKQogICAgICAgICAgICBpZiB1c2VyX2lkIGluIGhpc3Rvcnk6CiAgICAgICAgICAgICAgICBmb3Igd2FybiBpbiBoaXN0b3J5W3VzZXJfaWRdWyd3YXJucyddOgogICAgICAgICAgICAgICAgICAgIGlmIHdhcm4uZ2V0KCdpZCcpID09IHdhcm5faWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5bJ2V4cGlyZWQnXSA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeVt1c2VyX2lkXVsnbGFzdF93YXJuX2V4cGlyZWQnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkKICAgICAgICBleGNlcHQgYXN5bmNpby5DYW5jZWxsZWRFcnJvcjoKICAgICAgICAgICAgcmV0dXJuCiAgICBib3QubG9vcC5jcmVhdGVfdGFzayhleHBpcmVfd2FybigpKQoKQGJvdC50cmVlLmNvbW1hbmQobmFtZT0ndGVhbWtpY2snLCBkZXNjcmlwdGlvbj0nRW50ZmVybnQgZWluIFRlYW1taXRnbGllZCBhdXMgZGVtIFRlYW0uJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGVudGZlcm50IHdpcmQuJywgcmVhc29uPSdHcnVuZCBmw7xyIGRlbiBLaWNrJykKYXN5bmMgZGVmIHRlYW1raWNrKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCByZWFzb246IHN0cik6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCd0ZWFta2ljaycpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgdGVhbV9yb2xlcyA9IFtyb2xlIGZvciByb2xlIGluIG1lbWJlci5yb2xlcyBpZiByb2xlLmlkIGluIFRFQU1fUk9MRV9JRFNdCiAgICBpZiBub3QgdGVhbV9yb2xlczoKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2VzIE1pdGdsaWVkIGhhdCBrZWluZSBUZWFtcm9sbGUuJywgZXBoZW1lcmFsPVRydWUpCiAgICBmb3Igcm9sZSBpbiB0ZWFtX3JvbGVzOgogICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkKICAgIGVtYmVkID0gY3JlYXRlX2VtYmVkKCd0ZWFta2ljaycsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgcmVhc29uPXJlYXNvbiwgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uKQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinIUgRGVyIFRlYW1raWNrIHd1cmRlIGVyZm9sZ3JlaWNoIGR1cmNoZ2Vmw7xocnQhJywgZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgJ1RlYW1raWNrJywgZidEdSB3dXJkZXN0IGF1cyBkZW0gVGVhbSBlbnRmZXJudC5cblxuKipHcnVuZDoqKiB7cmVhc29ufScsIGludGVyYWN0aW9uKQogICAgdXBkYXRlX2hpc3RvcnkobWVtYmVyLCAnVGVhbWtpY2snLCBmJ0dydW5kOiB7cmVhc29ufSB8IER1cmNoZ2Vmw7xocnQgdm9uOiB7aW50ZXJhY3Rpb24udXNlci5kaXNwbGF5X25hbWV9JykKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3RlYW1tZW1iZXJoaXN0b3J5JywgZGVzY3JpcHRpb249J1plaWd0IGRpZSBIaXN0b3JpZSBlaW5lcyBUZWFtbWl0Z2xpZWRzLicpCkBhcHBfY29tbWFuZHMuZGVzY3JpYmUobWVtYmVyPSdEYXMgTWl0Z2xpZWQsIGRlc3NlbiBIaXN0b3JpZSBhbmdlemVpZ3Qgd2VyZGVuIHNvbGwuJykKYXN5bmMgZGVmIHRlYW1tZW1iZXJoaXN0b3J5KGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ2hpc3RvcnknKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgRnVua3Rpb24gaXN0IGRlYWt0aXZpZXJ0LicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgbm90IGFueSgocm9sZS5pZCBpbiBBRE1JTl9ST0xFX0lEUyBmb3Igcm9sZSBpbiBpbnRlcmFjdGlvbi51c2VyLnJvbGVzKSk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIER1IGhhc3Qga2VpbmUgQmVyZWNodGlndW5nIGbDvHIgZGllc2VuIEJlZmVobC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHVzZXJfaWQgPSBzdHIobWVtYmVyLmlkKQogICAgaWYgdXNlcl9pZCBub3QgaW4gaGlzdG9yeToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfimqDvuI8gS2VpbmUgSGlzdG9yaWUgZsO8ciBkaWVzZXMgTWl0Z2xpZWQgZ2VmdW5kZW4uJywgZXBoZW1lcmFsPVRydWUpCiAgICBjdXJyZW50X3RpbWUgPSBkYXRldGltZS5ub3coKS50aW1lc3RhbXAoKQogICAgZm9yIHdhcm4gaW4gaGlzdG9yeVt1c2VyX2lkXS5nZXQoJ3dhcm5zJywgW10pOgogICAgICAgIGlmICdleHBpcmVzJyBpbiB3YXJuOgogICAgICAgICAgICBleHBpcmVzID0gZmxvYXQod2FyblsnZXhwaXJlcyddKQogICAgICAgICAgICB3YXJuWydleHBpcmVkJ10gPSBleHBpcmVzIDwgY3VycmVudF90aW1lCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkKICAgIHVzZXJfaGlzdG9yeSA9IGhpc3RvcnlbdXNlcl9pZF0KICAgIGxhc3RfdXByYW5rID0gdXNlcl9oaXN0b3J5LmdldCgnbGFzdF91cHJhbmsnLCAnTi9BJykKICAgIHRvdGFsX3dhcm5zID0gbGVuKHVzZXJfaGlzdG9yeS5nZXQoJ3dhcm5zJywgW10pKQogICAgYWN0aXZlX3dhcm5zID0gc3VtKCgxIGZvciB3YXJuIGluIHVzZXJfaGlzdG9yeS5nZXQoJ3dhcm5zJywgW10pIGlmIG5vdCB3YXJuLmdldCgnZXhwaXJlZCcsIEZhbHNlKSkpCiAgICBsYXN0X3dhcm5fZXhwaXJlZCA9ICdOL0EnCiAgICBleHBpcmVkX3dhcm5zID0gW3cgZm9yIHcgaW4gdXNlcl9oaXN0b3J5LmdldCgnd2FybnMnLCBbXSkgaWYgdy5nZXQoJ2V4cGlyZWQnLCBGYWxzZSldCiAgICBpZiBleHBpcmVkX3dhcm5zOgogICAgICAgIGxhc3RfZXhwaXJlID0gbWF4KChmbG9hdCh3WydleHBpcmVzJ10pIGZvciB3IGluIGV4cGlyZWRfd2FybnMpKQogICAgICAgIGxhc3Rfd2Fybl9leHBpcmVkID0gZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChsYXN0X2V4cGlyZSkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJykKICAgIGN1cnJlbnRfcmFuayA9IG5leHQoKHJvbGUubmFtZSBmb3Igcm9sZSBpbiBtZW1iZXIucm9sZXMgaWYgcm9sZS5pZCBpbiBURUFNX1JPTEVfSURTKSwgJ04vQScpCiAgICBqb2luZWRfYXQgPSB1c2VyX2hpc3RvcnkuZ2V0KCdqb2luZWRfYXQnLCAnTi9BJykKICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT1mJ/Cfk5wgSGlzdG9yaWUgdm9uIHttZW1iZXIuZGlzcGxheV9uYW1lfScsIGNvbG9yPWRpc2NvcmQuQ29sb3IuYmx1ZSgpKQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0ltIFRlYW0gc2VpdCcsIHZhbHVlPWpvaW5lZF9hdCwgaW5saW5lPUZhbHNlKQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0FrdHVlbGxlciBSYW5nJywgdmFsdWU9Y3VycmVudF9yYW5rLCBpbmxpbmU9RmFsc2UpCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nTGV0enRlciBVcHJhbmsnLCB2YWx1ZT1sYXN0X3VwcmFuaywgaW5saW5lPUZhbHNlKQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0dlc2FtdGUgV2FybnVuZ2VuJywgdmFsdWU9c3RyKHRvdGFsX3dhcm5zKSwgaW5saW5lPVRydWUpCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nQWt0aXZlIFdhcm51bmdlbicsIHZhbHVlPXN0cihhY3RpdmVfd2FybnMpLCBpbmxpbmU9VHJ1ZSkKICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdMZXR6dGUgYWJnZWxhdWZlbmUgV2FybnVuZycsIHZhbHVlPWxhc3Rfd2Fybl9leHBpcmVkLCBpbmxpbmU9RmFsc2UpCiAgICB3YXJuX2RldGFpbHMgPSBbXQogICAgZm9yIChpLCB3YXJuKSBpbiBlbnVtZXJhdGUodXNlcl9oaXN0b3J5LmdldCgnd2FybnMnLCBbXSksIDEpOgogICAgICAgIHN0YXR1cyA9ICfwn5S0IEFrdGl2JyBpZiBub3Qgd2Fybi5nZXQoJ2V4cGlyZWQnLCBGYWxzZSkgZWxzZSAn8J+foiBBYmdlbGF1ZmVuJwogICAgICAgIGlzc3VlZCA9IHdhcm4uZ2V0KCdpc3N1ZWQnLCAnVW5iZWthbm50JykKICAgICAgICBleHBpcmVzID0gZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChmbG9hdCh3YXJuWydleHBpcmVzJ10pKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKSBpZiAnZXhwaXJlcycgaW4gd2FybiBlbHNlICdVbmJla2FubnQnCiAgICAgICAgcmVhc29uID0gd2Fybi5nZXQoJ3JlYXNvbicsICdLZWluIEdydW5kIGFuZ2VnZWJlbicpCiAgICAgICAgd2Fybl9kZXRhaWxzLmFwcGVuZChmJ3tpfS4ge3N0YXR1c30gfCB7aXNzdWVkfSBiaXMge2V4cGlyZXN9XG5HcnVuZDoge3JlYXNvbn1cbicpCiAgICBoaXN0b3J5X3RleHQgPSAnXG4nLmpvaW4odXNlcl9oaXN0b3J5LmdldCgnZnVsbF9oaXN0b3J5JywgWydLZWluZSBFaW50csOkZ2UnXSkpCiAgICB3YXJuX3RleHQgPSAnXG4nLmpvaW4od2Fybl9kZXRhaWxzKSBpZiB3YXJuX2RldGFpbHMgZWxzZSAnS2VpbmUgV2FybnVuZ2VuJwogICAgZnVsbF90ZXh0ID0gZic9PT0gVk9MTFNUw4RORElHRSBISVNUT1JJRSA9PT1cbntoaXN0b3J5X3RleHR9XG5cbj09PSBXQVJOVU5HRU4gPT09XG57d2Fybl90ZXh0fScKICAgIGhpc3RvcnlfZmlsZSA9IGRpc2NvcmQuRmlsZShpby5TdHJpbmdJTyhmdWxsX3RleHQpLCBmaWxlbmFtZT1mJ3ttZW1iZXIuZGlzcGxheV9uYW1lfV9oaXN0b3J5LnR4dCcpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoZW1iZWQ9ZW1iZWQsIGZpbGU9aGlzdG9yeV9maWxlLCBlcGhlbWVyYWw9VHJ1ZSkKYm90LnJ1bihUT0tFTik=').decode('utf-8'))