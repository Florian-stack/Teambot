import base64; exec(base64.b64decode('aW1wb3J0IGRpc2NvcmQKZnJvbSBkaXNjb3JkIGltcG9ydCBhcHBfY29tbWFuZHMKZnJvbSBkaXNjb3JkLmV4dCBpbXBvcnQgY29tbWFuZHMKaW1wb3J0IGpzb24KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YSwgdGltZXpvbmUKaW1wb3J0IG9zCmltcG9ydCBhc3luY2lvCmltcG9ydCBpbwp3aXRoIG9wZW4oJ2NvbmZpZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgY29uZmlnID0ganNvbi5sb2FkKGYpClRPS0VOID0gY29uZmlnWydib3RfdG9rZW4nXQpHVUlMRF9JRCA9IGNvbmZpZ1snZ3VpbGRfaWQnXQpURUFNX1JPTEVfSURTID0gW2ludChyb2xlX2lkKSBmb3Igcm9sZV9pZCBpbiBjb25maWdbJ3RlYW1fcm9sZV9pZCddXQpBRE1JTl9ST0xFX0lEUyA9IFtpbnQocm9sZV9pZCkgZm9yIHJvbGVfaWQgaW4gY29uZmlnWydhZG1pbl9yb2xlX2lkJ11dCldBUk5fUk9MRVMgPSB7azogaW50KHYpIGZvciBrLCB2IGluIGNvbmZpZ1snd2Fybl9yb2xlcyddLml0ZW1zKCl9CldBUk5fRklMRSA9ICd3YXJucy5qc29uJwpISVNUT1JZX0ZJTEUgPSAnbWVtYmVyX2hpc3RvcnkuanNvbicKaW50ZW50cyA9IGRpc2NvcmQuSW50ZW50cy5hbGwoKQpib3QgPSBjb21tYW5kcy5Cb3QoY29tbWFuZF9wcmVmaXg9Jy8nLCBpbnRlbnRzPWludGVudHMpCmxhc3RfbWVzc2FnZSA9IE5vbmUKbGFzdF9jaGFubmVsID0gTm9uZQoKZGVmIGlzX2ZlYXR1cmVfZW5hYmxlZChmZWF0dXJlOiBzdHIpIC0+IGJvb2w6CiAgICByZXR1cm4gY29uZmlnWydmZWF0dXJlcyddLmdldChmZWF0dXJlLCBUcnVlKQoKZGVmIGNyZWF0ZV9lbWJlZChuYW1lOiBzdHIsICoqa3dhcmdzKSAtPiBkaXNjb3JkLkVtYmVkOgogICAgc2V0dGluZ3MgPSBjb25maWdbJ2VtYmVkcyddLmdldChuYW1lLCB7fSkKICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT1zZXR0aW5ncy5nZXQoJ3RpdGxlJywgJ0tlaW4gVGl0ZWwnKSwgZGVzY3JpcHRpb249c2V0dGluZ3MuZ2V0KCdkZXNjcmlwdGlvbicsICcnKS5mb3JtYXQoKiprd2FyZ3MpLCBjb2xvcj1kaXNjb3JkLkNvbG9yKHNldHRpbmdzLmdldCgnY29sb3InLCAzNDQ3MDAzKSkpCiAgICBpZiAnYXV0aG9yJyBpbiBzZXR0aW5nczoKICAgICAgICBlbWJlZC5zZXRfYXV0aG9yKG5hbWU9c2V0dGluZ3NbJ2F1dGhvciddLmdldCgnbmFtZScsICcnKSwgaWNvbl91cmw9c2V0dGluZ3NbJ2F1dGhvciddLmdldCgnaWNvbl91cmwnLCAnJykpCiAgICBpZiAndGh1bWJuYWlsJyBpbiBzZXR0aW5nczoKICAgICAgICBlbWJlZC5zZXRfdGh1bWJuYWlsKHVybD1zZXR0aW5nc1sndGh1bWJuYWlsJ10pCiAgICBpZiAnZm9vdGVyJyBpbiBzZXR0aW5nczoKICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9c2V0dGluZ3NbJ2Zvb3RlciddLmdldCgndGV4dCcsICcnKSwgaWNvbl91cmw9c2V0dGluZ3NbJ2Zvb3RlciddLmdldCgnaWNvbl91cmwnLCAnJykpCiAgICBpZiBzZXR0aW5ncy5nZXQoJ3RpbWVzdGFtcCcsIEZhbHNlKToKICAgICAgICBlbWJlZC50aW1lc3RhbXAgPSBkYXRldGltZS5ub3codGltZXpvbmUudXRjKQogICAgcmV0dXJuIGVtYmVkCgpkZWYgbG9hZF93YXJucygpOgogICAgaWYgb3MucGF0aC5leGlzdHMoV0FSTl9GSUxFKToKICAgICAgICB3aXRoIG9wZW4oV0FSTl9GSUxFLCAncicpIGFzIGY6CiAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWQoZikKICAgIHJldHVybiB7fQoKZGVmIHNhdmVfd2FybnMoKToKICAgIHdpdGggb3BlbihXQVJOX0ZJTEUsICd3JykgYXMgZjoKICAgICAgICBqc29uLmR1bXAod2FybnMsIGYsIGluZGVudD00KQp3YXJucyA9IGxvYWRfd2FybnMoKQoKZGVmIGxvYWRfaGlzdG9yeSgpOgogICAgaWYgb3MucGF0aC5leGlzdHMoSElTVE9SWV9GSUxFKToKICAgICAgICB3aXRoIG9wZW4oSElTVE9SWV9GSUxFLCAncicpIGFzIGY6CiAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWQoZikKICAgIHJldHVybiB7fQoKZGVmIHNhdmVfaGlzdG9yeShoaXN0b3J5KToKICAgIHdpdGggb3BlbihISVNUT1JZX0ZJTEUsICd3JykgYXMgZjoKICAgICAgICBqc29uLmR1bXAoaGlzdG9yeSwgZiwgaW5kZW50PTQpCgpkZWYgdXBkYXRlX2hpc3RvcnkobWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgYWN0aW9uOiBzdHIsIGRldGFpbHM6IHN0cik6CiAgICB1c2VyX2lkID0gc3RyKG1lbWJlci5pZCkKICAgIGlmIHVzZXJfaWQgbm90IGluIGhpc3Rvcnk6CiAgICAgICAgaGlzdG9yeVt1c2VyX2lkXSA9IHsnam9pbmVkX2F0JzogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyksICdsYXN0X3VwcmFuayc6ICdOL0EnLCAnd2FybnMnOiBbXSwgJ2xhc3Rfd2Fybl9leHBpcmVkJzogJ04vQScsICdmdWxsX2hpc3RvcnknOiBbXX0KICAgIGlmIGFjdGlvbiA9PSAnVXByYW5rJzoKICAgICAgICBoaXN0b3J5W3VzZXJfaWRdWydsYXN0X3VwcmFuayddID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJykKICAgIGVsaWYgYWN0aW9uID09ICdXYXJuJyBhbmQgJ2V4cGlyZWQnIGluIGRldGFpbHMubG93ZXIoKToKICAgICAgICBoaXN0b3J5W3VzZXJfaWRdWydsYXN0X3dhcm5fZXhwaXJlZCddID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJykKICAgIGhpc3RvcnlbdXNlcl9pZF1bJ2Z1bGxfaGlzdG9yeSddLmFwcGVuZChmJ1t7ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyl9XSB7YWN0aW9ufToge2RldGFpbHN9JykKICAgIHNhdmVfaGlzdG9yeShoaXN0b3J5KQpoaXN0b3J5ID0gbG9hZF9oaXN0b3J5KCkKCkBib3QuZXZlbnQKYXN5bmMgZGVmIG9uX3JlYWR5KCk6CiAgICBwcmludChmJ0JvdCBpc3Qgb25saW5lOiB7Ym90LnVzZXJ9IScpCiAgICBwcmludCgnU2xhc2gtQ29tbWFuZHMgd2VyZGVuIHN5bmNocm9uaXNpZXJ0Li4uJykKICAgIHRyeToKICAgICAgICBndWlsZCA9IGRpc2NvcmQuT2JqZWN0KGlkPUdVSUxEX0lEKQogICAgICAgIGF3YWl0IGJvdC50cmVlLnN5bmMoKQogICAgICAgIHN5bmNlZCA9IGF3YWl0IGJvdC50cmVlLnN5bmMoZ3VpbGQ9Z3VpbGQpCiAgICAgICAgcHJpbnQoZidTeW5jZWQge2xlbihzeW5jZWQpfSBjb21tYW5kcyBmb3IgZ3VpbGQge0dVSUxEX0lEfScpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZidGZWhsZXIgYmVpbSBTeW5jaHJvbmlzaWVyZW46IHtlfScpCgphc3luYyBkZWYgc2VuZF9kbShtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCB0aXRsZTogc3RyLCBkZXNjcmlwdGlvbjogc3RyLCBpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbik6CiAgICB0cnk6CiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPXRpdGxlLCBkZXNjcmlwdGlvbj1kZXNjcmlwdGlvbiwgY29sb3I9ZGlzY29yZC5Db2xvci5ibHVlKCkpCiAgICAgICAgaWYgaW50ZXJhY3Rpb24uY2hhbm5lbDoKICAgICAgICAgICAgbGFzdF9tZXNzYWdlID0gYXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbC5zZW5kKCcuJykKICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J01laHIgSW5mb3MnLCB2YWx1ZT1mJ1tOYWNocmljaHQgYW56ZWlnZW5dKGh0dHBzOi8vZGlzY29yZC5jb20vY2hhbm5lbHMve2ludGVyYWN0aW9uLmd1aWxkLmlkfS97aW50ZXJhY3Rpb24uY2hhbm5lbC5pZH0ve2xhc3RfbWVzc2FnZS5pZH0pJykKICAgICAgICAgICAgYXdhaXQgbGFzdF9tZXNzYWdlLmRlbGV0ZSgpCiAgICAgICAgYXdhaXQgbWVtYmVyLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgcHJpbnQoZidbV0FSTlVOR10gS29ubnRlIHttZW1iZXJ9IGtlaW5lIERNIHNlbmRlbiAoRE1zIG3DtmdsaWNoZXJ3ZWlzZSBkZWFrdGl2aWVydCkuJykKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3RlYW1saXN0ZScsIGRlc2NyaXB0aW9uPSdaZWlndCBkaWUgVGVhbW1pdGdsaWVkZXIgdW5kIGlocmUgUm9sbGVuLicpCmFzeW5jIGRlZiB0ZWFtbGlzdGUoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24pOgogICAgaWYgbm90IGlzX2ZlYXR1cmVfZW5hYmxlZCgndGVhbWxpc3RlJyk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERpZSBUZWFtbGlzdGUgd2lyZCBha3R1YWxpc2llcnQhJywgZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCB1cGRhdGVfdGVhbWxpc3RlKGludGVyYWN0aW9uLmNoYW5uZWwpCgphc3luYyBkZWYgdXBkYXRlX3RlYW1saXN0ZShjaGFubmVsKToKICAgIGdsb2JhbCBsYXN0X21lc3NhZ2UsIGxhc3RfY2hhbm5lbAogICAgcHJpbnQoZidbREVCVUddIFN0YXJ0aW5nIHRlYW0gbGlzdCB1cGRhdGUgaW4gY2hhbm5lbDoge2NoYW5uZWwubmFtZX0nKQogICAgdHJ5OgogICAgICAgIGd1aWxkID0gY2hhbm5lbC5ndWlsZAogICAgICAgIHRlYW1fcm9sZXMgPSB7fQogICAgICAgIGZvciByb2xlX2lkIGluIFRFQU1fUk9MRV9JRFM6CiAgICAgICAgICAgIHJvbGUgPSBkaXNjb3JkLnV0aWxzLmdldChndWlsZC5yb2xlcywgaWQ9aW50KHJvbGVfaWQpKQogICAgICAgICAgICBpZiByb2xlOgogICAgICAgICAgICAgICAgdGVhbV9yb2xlc1tyb2xlLmlkXSA9IHJvbGUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYnW0VSUk9SXSBUZWFtIHJvbGUgd2l0aCBJRCB7cm9sZV9pZH0gbm90IGZvdW5kIScpCiAgICAgICAgaWYgbm90IHRlYW1fcm9sZXM6CiAgICAgICAgICAgIHByaW50KCdbRVJST1JdIE5vIHZhbGlkIHRlYW0gcm9sZXMgZm91bmQhJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgdGVhbV9tZW1iZXJzID0ge3JvbGU6IFtdIGZvciByb2xlIGluIHRlYW1fcm9sZXMudmFsdWVzKCl9CiAgICAgICAgdG90YWxfbWVtYmVycyA9IDAKICAgICAgICBmb3IgbWVtYmVyIGluIGd1aWxkLm1lbWJlcnM6CiAgICAgICAgICAgIGZvciByb2xlIGluIG1lbWJlci5yb2xlczoKICAgICAgICAgICAgICAgIGlmIHJvbGUuaWQgaW4gdGVhbV9yb2xlczoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ1tERUJVR10gRm91bmQgdGVhbSBtZW1iZXI6IHttZW1iZXIuZGlzcGxheV9uYW1lfSB3aXRoIHJvbGU6IHtyb2xlLm5hbWV9JykKICAgICAgICAgICAgICAgICAgICB0ZWFtX21lbWJlcnNbcm9sZV0uYXBwZW5kKG1lbWJlci5tZW50aW9uKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX21lbWJlcnMgKz0gMQogICAgICAgIHByaW50KGYnW0RFQlVHXSBGb3VuZCB7dG90YWxfbWVtYmVyc30gdGVhbSBtZW1iZXJzIGFjcm9zcyBhbGwgcm9sZXMnKQogICAgICAgIGVtYmVkID0gY3JlYXRlX2VtYmVkKCd0ZWFtbGlzdGUnKQogICAgICAgIGRlc2NyaXB0aW9uID0gJycKICAgICAgICBmb3Igcm9sZSwgbWVtYmVycyBpbiB0ZWFtX21lbWJlcnMuaXRlbXMoKToKICAgICAgICAgICAgcm9sZV9tZW50aW9uID0gcm9sZS5tZW50aW9uCiAgICAgICAgICAgIG1lbWJlcnNfbGlzdCA9ICdcbicuam9pbihtZW1iZXJzKSBpZiBtZW1iZXJzIGVsc2UgJ0tlaW5lIE1pdGdsaWVkZXInCiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9IGYnKip7cm9sZV9tZW50aW9ufSoqICh7bGVuKG1lbWJlcnMpfSBNaXRnbGllZGVyKVxue21lbWJlcnNfbGlzdH1cblxuJwogICAgICAgIGVtYmVkLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24KICAgICAgICB0ZWFtbGlzdGVfc2V0dGluZ3MgPSBjb25maWdbJ2VtYmVkcyddLmdldCgndGVhbWxpc3RlJywge30pCiAgICAgICAgaWYgJ2ltYWdlJyBpbiB0ZWFtbGlzdGVfc2V0dGluZ3M6CiAgICAgICAgICAgIGVtYmVkLnNldF9pbWFnZSh1cmw9dGVhbWxpc3RlX3NldHRpbmdzWydpbWFnZSddKQogICAgICAgIGlmIGxhc3RfbWVzc2FnZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgbGFzdF9tZXNzYWdlLmRlbGV0ZSgpCiAgICAgICAgICAgIGV4Y2VwdCBkaXNjb3JkLk5vdEZvdW5kOgogICAgICAgICAgICAgICAgcHJpbnQoJ1tERUJVR10gT2xkIG1lc3NhZ2Ugbm90IGZvdW5kIChtYXkgaGF2ZSBiZWVuIGRlbGV0ZWQgYWxyZWFkeSknKQogICAgICAgICAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgICAgICAgICBwcmludCgnW0VSUk9SXSBCb3QgbGFja3MgcGVybWlzc2lvbnMgdG8gZGVsZXRlIG1lc3NhZ2UnKQogICAgICAgIGxhc3RfbWVzc2FnZSA9IGF3YWl0IGNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgICAgICBsYXN0X2NoYW5uZWwgPSBjaGFubmVsCiAgICAgICAgcHJpbnQoJ1tERUJVR10gVGVhbSBsaXN0IHN1Y2Nlc3NmdWxseSB1cGRhdGVkIScpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZidbRVJST1JdIEZhaWxlZCB0byB1cGRhdGUgdGVhbSBsaXN0OiB7c3RyKGUpfScpCiAgICAgICAgcmFpc2UgZQoKQGJvdC5ldmVudAphc3luYyBkZWYgb25fbWVtYmVyX3VwZGF0ZShiZWZvcmU6IGRpc2NvcmQuTWVtYmVyLCBhZnRlcjogZGlzY29yZC5NZW1iZXIpOgogICAgYWRkZWRfcm9sZXMgPSBbcm9sZSBmb3Igcm9sZSBpbiBhZnRlci5yb2xlcyBpZiByb2xlIG5vdCBpbiBiZWZvcmUucm9sZXNdCiAgICByZW1vdmVkX3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gYmVmb3JlLnJvbGVzIGlmIHJvbGUgbm90IGluIGFmdGVyLnJvbGVzXQogICAgcmVsZXZhbnRfcm9sZXMgPSBbcm9sZSBmb3Igcm9sZSBpbiBhZGRlZF9yb2xlcyArIHJlbW92ZWRfcm9sZXMgaWYgcm9sZS5pZCBpbiBURUFNX1JPTEVfSURTXQogICAgaWYgcmVsZXZhbnRfcm9sZXMgYW5kIGxhc3RfY2hhbm5lbDoKICAgICAgICBhd2FpdCB1cGRhdGVfdGVhbWxpc3RlKGxhc3RfY2hhbm5lbCkKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3RlYW1iZWl0cml0dCcsIGRlc2NyaXB0aW9uPSdGw7xndCBlaW5lbiBVc2VyIGluIGRhcyBUZWFtIGVpbi4nKQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0nRGFzIE1pdGdsaWVkLCBkYXMgYmVpdHJldGVuIHNvbGwuJywgcm9sZT0nRGllIHNwZXppZWxsZSBUZWFtcm9sbGUsIGRpZSB6dWdld2llc2VuIHdpcmQuJykKYXN5bmMgZGVmIHRlYW1iZWl0cml0dChpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcm9sZTogZGlzY29yZC5Sb2xlKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ3RlYW1iZWl0cml0dCcpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgcm9sZS5pZCBub3QgaW4gVEVBTV9ST0xFX0lEUzoKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgUm9sbGUgaXN0IGtlaW5lIGfDvGx0aWdlIFRlYW1yb2xsZS4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHN0YW5kYXJkX3RlYW1fcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1URUFNX1JPTEVfSURTWzBdKQogICAgaWYgbm90IHN0YW5kYXJkX3RlYW1fcm9sZToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgU3RhbmRhcmQtVGVhbXJvbGxlIHd1cmRlIG5pY2h0IGdlZnVuZGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhzdGFuZGFyZF90ZWFtX3JvbGUsIHJvbGUpCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndGVhbWJlaXRyaXR0JywgbWVtYmVyPW1lbWJlci5tZW50aW9uLCByb2xlPXJvbGUubWVudGlvbiwgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLCBhZG1pbl9yb2xlcz0nLCAnLmpvaW4oKGYnPEAme3JvbGVfaWR9PicgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpKSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERlciBCZWl0cml0dCB3dXJkZSBlcmZvbGdyZWljaCB2ZXJhcmJlaXRldCEnLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIGF3YWl0IHNlbmRfZG0obWVtYmVyLCAnVGVhbWJlaXRyaXR0JywgZidXaWxsa29tbWVuIGltIFRlYW0gYWxzIHtyb2xlLm5hbWV9LiBXaXIgZnJldWVuIHVucyBhdWYgZGljaC4nLCBpbnRlcmFjdGlvbikKICAgIHVwZGF0ZV9oaXN0b3J5KG1lbWJlciwgJ1RlYW1iZWl0cml0dCcsIGYnQmVpZ2V0cmV0ZW4gbWl0IFJvbGxlIHtyb2xlLm5hbWV9IHwgRWluZ2VsYWRlbiB2b246IHtpbnRlcmFjdGlvbi51c2VyLmRpc3BsYXlfbmFtZX0nKQoKQGJvdC50cmVlLmNvbW1hbmQobmFtZT0ndXByYW5rJywgZGVzY3JpcHRpb249J0JlZsO2cmRlcnQgZWluIFRlYW1taXRnbGllZC4nKQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0nRGFzIE1pdGdsaWVkLCBkYXMgYmVmw7ZyZGVydCB3aXJkLicsIG9sZF9yb2xlPSdBbHRlIFJvbGxlJywgbmV3X3JvbGU9J05ldWUgUm9sbGUnKQphc3luYyBkZWYgdXByYW5rKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCBvbGRfcm9sZTogZGlzY29yZC5Sb2xlLCBuZXdfcm9sZTogZGlzY29yZC5Sb2xlKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ3VwcmFuaycpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgb2xkX3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFMgb3IgbmV3X3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFM6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEVpbmUgZGVyIFJvbGxlbiBpc3Qga2VpbmUgZ8O8bHRpZ2UgVGVhbXJvbGxlLicsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhvbGRfcm9sZSkKICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMobmV3X3JvbGUpCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndXByYW5rJywgbWVtYmVyPW1lbWJlci5tZW50aW9uLCBvbGRfcm9sZT1vbGRfcm9sZS5tZW50aW9uLCBuZXdfcm9sZT1uZXdfcm9sZS5tZW50aW9uLCBhZG1pbj1pbnRlcmFjdGlvbi51c2VyLm1lbnRpb24sIGFkbWluX3JvbGVzPScsICcuam9pbigoZic8QCZ7cm9sZV9pZH0+JyBmb3Igcm9sZV9pZCBpbiBBRE1JTl9ST0xFX0lEUykpKQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinIUgRGVyIFVwcmFuayB3dXJkZSBlcmZvbGdyZWljaCBkdXJjaGdlZsO8aHJ0IScsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQogICAgYXdhaXQgc2VuZF9kbShtZW1iZXIsICdVcHJhbmsnLCBmJ0R1IGhhc3QgZWluICoqVXByYW5rKiogdm9uIHtvbGRfcm9sZS5uYW1lfSB6dSB7bmV3X3JvbGUubmFtZX0gZXJoYWx0ZW4uJywgaW50ZXJhY3Rpb24pCiAgICBoaXN0b3J5W3N0cihtZW1iZXIuaWQpXVsnbGFzdF91cHJhbmsnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICB1cGRhdGVfaGlzdG9yeShtZW1iZXIsICdVcHJhbmsnLCBmJ0JlZsO2cmRlcnQgdm9uIHtvbGRfcm9sZS5uYW1lfSB6dSB7bmV3X3JvbGUubmFtZX0gfCBEdXJjaDoge2ludGVyYWN0aW9uLnVzZXIuZGlzcGxheV9uYW1lfScpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSdkZXJhbmsnLCBkZXNjcmlwdGlvbj0nU2V0enQgZGllIFRlYW1yb2xsZSBlaW5lcyBNaXRnbGllZHMgaGVyYWIuJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGRlZ3JhZGllcnQgd2lyZC4nLCBvbGRfcm9sZT0nRGllIHZvcmhlcmlnZSBSb2xsZS4nLCBuZXdfcm9sZT0nRGllIG5ldWUgUm9sbGUuJywgcmVhc29uPSdEZXIgR3J1bmQgZsO8ciBkZW4gRGVyYW5rLicpCmFzeW5jIGRlZiBkZXJhbmsoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24sIG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIG9sZF9yb2xlOiBkaXNjb3JkLlJvbGUsIG5ld19yb2xlOiBkaXNjb3JkLlJvbGUsIHJlYXNvbjogc3RyKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ2RlcmFuaycpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgb2xkX3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFMgb3IgbmV3X3JvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFM6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEVpbmUgb2RlciBiZWlkZSBSb2xsZW4gc2luZCBrZWluZSBnw7xsdGlnZW4gVGVhbXJvbGxlbi4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHRyeToKICAgICAgICBhd2FpdCBtZW1iZXIucmVtb3ZlX3JvbGVzKG9sZF9yb2xlKQogICAgICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMobmV3X3JvbGUpCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEJvdCBoYXQga2VpbmUgQmVyZWNodGlndW5nLCBSb2xsZW4genUgdmVyd2FsdGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgZXhjZXB0IGRpc2NvcmQuSFRUUEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRmVobGVyIGJlaW0gQWt0dWFsaXNpZXJlbiBkZXIgUm9sbGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoJ2RlcmFuaycsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgb2xkX3JvbGU9b2xkX3JvbGUubWVudGlvbiwgbmV3X3JvbGU9bmV3X3JvbGUubWVudGlvbiwgcmVhc29uPXJlYXNvbiwgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLCBhZG1pbl9yb2xlcz0nLCAnLmpvaW4oKGYnPEAme3JvbGVfaWR9PicgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpKSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERlciBEZXJhbmsgd3VyZGUgZXJmb2xncmVpY2ggZHVyY2hnZWbDvGhydCEnLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIHRyeToKICAgICAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgJ0RlcmFuaycsIGYnRHUgaGFzdCBlaW4gKipEZXJhbmsqKiB2b24ge29sZF9yb2xlLm5hbWV9IHp1IHtuZXdfcm9sZS5uYW1lfSBlcmhhbHRlbi5cblxuKipHcnVuZDoqKiB7cmVhc29ufScsIGludGVyYWN0aW9uKQogICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgIHByaW50KGYnW1dBUk5VTkddIEtvbm50ZSB7bWVtYmVyfSBrZWluZSBETSBzZW5kZW4gKERNcyBtw7ZnbGljaGVyd2Vpc2UgZGVha3RpdmllcnQpLicpCiAgICBpZiBzdHIobWVtYmVyLmlkKSBub3QgaW4gaGlzdG9yeToKICAgICAgICBoaXN0b3J5W3N0cihtZW1iZXIuaWQpXSA9IHsnam9pbmVkX2F0JzogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyksICdsYXN0X3VwcmFuayc6ICdOL0EnLCAnd2FybnMnOiBbXSwgJ2xhc3Rfd2Fybl9leHBpcmVkJzogJ04vQScsICdmdWxsX2hpc3RvcnknOiBbXX0KICAgIGhpc3Rvcnlbc3RyKG1lbWJlci5pZCldWydmdWxsX2hpc3RvcnknXS5hcHBlbmQoZidbe2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpfV0gRGVyYW5rOiBWb24ge29sZF9yb2xlLm5hbWV9IHp1IHtuZXdfcm9sZS5uYW1lfSBkdXJjaCB7aW50ZXJhY3Rpb24udXNlci5kaXNwbGF5X25hbWV9LCBHcnVuZDoge3JlYXNvbn0nKQogICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSd0ZWFtd2FybicsIGRlc2NyaXB0aW9uPSdHaWJ0IGVpbmVtIFRlYW1taXRnbGllZCBlaW5lIFdhcm51bmcuJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGdld2FybnQgd2lyZC4nLCByZWFzb249J0dydW5kIGbDvHIgZGllIFdhcm51bmcuJywgZHVyYXRpb249J0RhdWVyIGluIFNla3VuZGVuJykKYXN5bmMgZGVmIHRlYW13YXJuKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCByZWFzb246IHN0ciwgZHVyYXRpb246IGludCk6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCd0ZWFtd2FybicpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgd2Fybl9pZCA9IHN0cihpbnQoZGF0ZXRpbWUubm93KCkudGltZXN0YW1wKCkpKSArIHN0cihtZW1iZXIuaWQpCiAgICB1c2VyX2lkID0gc3RyKG1lbWJlci5pZCkKICAgIGlmIHVzZXJfaWQgbm90IGluIHdhcm5zOgogICAgICAgIHdhcm5zW3VzZXJfaWRdID0gW10KICAgIHdhcm5zW3VzZXJfaWRdLmFwcGVuZCh7J2lkJzogd2Fybl9pZCwgJ3JlYXNvbic6IHJlYXNvbiwgJ2V4cGlyZXMnOiAoZGF0ZXRpbWUubm93KCkgKyB0aW1lZGVsdGEoc2Vjb25kcz1kdXJhdGlvbikpLnRpbWVzdGFtcCgpLCAnYWRtaW4nOiBpbnRlcmFjdGlvbi51c2VyLmlkfSkKICAgIHNhdmVfd2FybnMoKQogICAgd2Fybl9jb3VudCA9IGxlbihbdyBmb3IgdyBpbiB3YXJucy5nZXQodXNlcl9pZCwgW10pIGlmIG5vdCB3LmdldCgnZXhwaXJlZCcsIEZhbHNlKV0pCiAgICByb2xlX2luZGV4ID0gKHdhcm5fY291bnQgLSAxKSAlIDMgKyAxCiAgICBmb3Igcm9sZV9pZCBpbiBjb25maWdbJ3dhcm5fcm9sZXMnXS52YWx1ZXMoKToKICAgICAgICByb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPXJvbGVfaWQpCiAgICAgICAgaWYgcm9sZSBhbmQgcm9sZSBpbiBtZW1iZXIucm9sZXM6CiAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkKICAgIG5ld19yb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPWNvbmZpZ1snd2Fybl9yb2xlcyddLmdldChzdHIocm9sZV9pbmRleCkpKQogICAgaWYgbmV3X3JvbGU6CiAgICAgICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhuZXdfcm9sZSkKICAgIG5ld19yb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPWNvbmZpZ1snd2Fybl9yb2xlcyddLmdldChzdHIod2Fybl9jb3VudCkpKQogICAgaWYgbmV3X3JvbGU6CiAgICAgICAgYXdhaXQgbWVtYmVyLmFkZF9yb2xlcyhuZXdfcm9sZSkKICAgIGVtYmVkID0gY3JlYXRlX2VtYmVkKCd0ZWFtd2FybicsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgcmVhc29uPXJlYXNvbiwgZHVyYXRpb249ZHVyYXRpb24sIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbiwgYWRtaW5fcm9sZXM9JywgJy5qb2luKChmJzxAJntyb2xlX2lkfT4nIGZvciByb2xlX2lkIGluIEFETUlOX1JPTEVfSURTKSkpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5kZWZlcihlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIHRyeToKICAgICAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgJ1RlYW13YXJuJywgZidEdSBoYXN0IGVpbmUgV2FybnVuZyBlcmhhbHRlbi5cbioqR3J1bmQ6Kioge3JlYXNvbn1cbioqRGF1ZXI6Kioge2R1cmF0aW9ufXNcbioqV2Fybi1JRDoqKiB7d2Fybl9pZH0nLCBpbnRlcmFjdGlvbikKICAgIGV4Y2VwdCBkaXNjb3JkLkZvcmJpZGRlbjoKICAgICAgICBwcmludChmJ0tvbm50ZSBETSBhbiB7bWVtYmVyfSBuaWNodCBzZW5kZW4nKQogICAgaWYgdXNlcl9pZCBub3QgaW4gaGlzdG9yeToKICAgICAgICBoaXN0b3J5W3VzZXJfaWRdID0geydqb2luZWRfYXQnOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKSwgJ3dhcm5zJzogW10sICdmdWxsX2hpc3RvcnknOiBbXX0KICAgIGhpc3RvcnlbdXNlcl9pZF1bJ3dhcm5zJ10uYXBwZW5kKHsnaWQnOiB3YXJuX2lkLCAncmVhc29uJzogcmVhc29uLCAnaXNzdWVkJzogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyksICdleHBpcmVzJzogKGRhdGV0aW1lLm5vdygpICsgdGltZWRlbHRhKHNlY29uZHM9ZHVyYXRpb24pKS50aW1lc3RhbXAoKSwgJ2FkbWluJzogaW50ZXJhY3Rpb24udXNlci5pZCwgJ2V4cGlyZWQnOiBGYWxzZX0pCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkKCiAgICBhc3luYyBkZWYgZXhwaXJlX3dhcm4oKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoZHVyYXRpb24pCiAgICAgICAgICAgIGlmIHVzZXJfaWQgbm90IGluIHdhcm5zOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHdhcm5fc3RpbGxfYWN0aXZlID0gRmFsc2UKICAgICAgICAgICAgZm9yIHdhcm4gaW4gd2FybnNbdXNlcl9pZF06CiAgICAgICAgICAgICAgICBpZiB3YXJuWydpZCddID09IHdhcm5faWQgYW5kIChub3Qgd2Fybi5nZXQoJ3JlbW92ZWQnLCBGYWxzZSkpOgogICAgICAgICAgICAgICAgICAgIHdhcm5fc3RpbGxfYWN0aXZlID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGlmIG5vdCB3YXJuX3N0aWxsX2FjdGl2ZToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB3YXJuX2xldmVsID0gTm9uZQogICAgICAgICAgICBmb3IgaSwgd2FybiBpbiBlbnVtZXJhdGUod2FybnNbdXNlcl9pZF0pOgogICAgICAgICAgICAgICAgaWYgd2FyblsnaWQnXSA9PSB3YXJuX2lkOgogICAgICAgICAgICAgICAgICAgIHdhcm5fbGV2ZWwgPSBpICsgMQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGlmIHdhcm5fbGV2ZWwgYW5kIHdhcm5fbGV2ZWwgPD0gMzoKICAgICAgICAgICAgICAgIHJvbGVfaWQgPSBjb25maWdbJ3dhcm5fcm9sZXMnXS5nZXQoc3RyKHdhcm5fbGV2ZWwpKQogICAgICAgICAgICAgICAgaWYgcm9sZV9pZDoKICAgICAgICAgICAgICAgICAgICByb2xlID0gZGlzY29yZC51dGlscy5nZXQoaW50ZXJhY3Rpb24uZ3VpbGQucm9sZXMsIGlkPXJvbGVfaWQpCiAgICAgICAgICAgICAgICAgICAgaWYgcm9sZSBhbmQgcm9sZSBpbiBtZW1iZXIucm9sZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMocm9sZSkKICAgICAgICAgICAgZm9yIHdhcm4gaW4gd2FybnNbdXNlcl9pZF06CiAgICAgICAgICAgICAgICBpZiB3YXJuWydpZCddID09IHdhcm5faWQ6CiAgICAgICAgICAgICAgICAgICAgd2FyblsnZXhwaXJlZCddID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHNhdmVfd2FybnMoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhd2FpdCBtZW1iZXIuc2VuZChlbWJlZD1kaXNjb3JkLkVtYmVkKHRpdGxlPSfinIUgV2FybnVuZyBhYmdlbGF1ZmVuJywgZGVzY3JpcHRpb249ZidEZWluZSBXYXJudW5nIGlzdCBhdXRvbWF0aXNjaCBhYmdlbGF1ZmVuLlxuXG4qKkdydW5kOioqIHtyZWFzb259XG4qKkRhdWVyOioqIHtkdXJhdGlvbn1zXG4qKldhcm4tSUQ6Kioge3dhcm5faWR9JywgY29sb3I9ZGlzY29yZC5Db2xvci5ncmVlbigpKSkKICAgICAgICAgICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBsb2dfY2hhbm5lbF9pZCA9IGNvbmZpZy5nZXQoJ3dhcm5fbG9nX2NoYW5uZWwnKQogICAgICAgICAgICBpZiBsb2dfY2hhbm5lbF9pZDoKICAgICAgICAgICAgICAgIGxvZ19jaGFubmVsID0gYm90LmdldF9jaGFubmVsKGxvZ19jaGFubmVsX2lkKQogICAgICAgICAgICAgICAgaWYgbG9nX2NoYW5uZWw6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9nX2NoYW5uZWwuc2VuZChlbWJlZD1kaXNjb3JkLkVtYmVkKHRpdGxlPSfimqDvuI8gV2FybnVuZyBhYmdlbGF1ZmVuJywgZGVzY3JpcHRpb249ZidXYXJudW5nIGbDvHIge21lbWJlci5tZW50aW9ufSBpc3QgYWJnZWxhdWZlbicsIGNvbG9yPWRpc2NvcmQuQ29sb3IuZ3JlZW4oKSwgdGltZXN0YW1wPWRhdGV0aW1lLm5vdygpKS5hZGRfZmllbGQobmFtZT0nR3J1bmQnLCB2YWx1ZT1yZWFzb24sIGlubGluZT1GYWxzZSkuYWRkX2ZpZWxkKG5hbWU9J0RhdWVyJywgdmFsdWU9Zid7ZHVyYXRpb259IFNla3VuZGVuJywgaW5saW5lPVRydWUpLmFkZF9maWVsZChuYW1lPSdXYXJuLUlEJywgdmFsdWU9d2Fybl9pZCwgaW5saW5lPVRydWUpLnNldF9mb290ZXIodGV4dD1mJ0F1dG9tYXRpc2NoIGFiZ2VsYXVmZW4nKSkKICAgICAgICAgICAgaWYgdXNlcl9pZCBpbiBoaXN0b3J5OgogICAgICAgICAgICAgICAgZm9yIHdhcm4gaW4gaGlzdG9yeVt1c2VyX2lkXVsnd2FybnMnXToKICAgICAgICAgICAgICAgICAgICBpZiB3YXJuLmdldCgnaWQnKSA9PSB3YXJuX2lkOgogICAgICAgICAgICAgICAgICAgICAgICB3YXJuWydleHBpcmVkJ10gPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlbdXNlcl9pZF1bJ2xhc3Rfd2Fybl9leHBpcmVkJ10gPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpCiAgICAgICAgZXhjZXB0IGFzeW5jaW8uQ2FuY2VsbGVkRXJyb3I6CiAgICAgICAgICAgIHJldHVybgogICAgYm90Lmxvb3AuY3JlYXRlX3Rhc2soZXhwaXJlX3dhcm4oKSkKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3RlYW1raWNrJywgZGVzY3JpcHRpb249J0VudGZlcm50IGVpbiBUZWFtbWl0Z2xpZWQgYXVzIGRlbSBUZWFtLicpCkBhcHBfY29tbWFuZHMuZGVzY3JpYmUobWVtYmVyPSdEYXMgTWl0Z2xpZWQsIGRhcyBlbnRmZXJudCB3aXJkLicsIHJlYXNvbj0nR3J1bmQgZsO8ciBkZW4gS2ljaycpCmFzeW5jIGRlZiB0ZWFta2ljayhpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcmVhc29uOiBzdHIpOgogICAgaWYgbm90IGlzX2ZlYXR1cmVfZW5hYmxlZCgndGVhbWtpY2snKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgRnVua3Rpb24gaXN0IGRlYWt0aXZpZXJ0LicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgbm90IGFueSgocm9sZS5pZCBpbiBBRE1JTl9ST0xFX0lEUyBmb3Igcm9sZSBpbiBpbnRlcmFjdGlvbi51c2VyLnJvbGVzKSk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIER1IGhhc3Qga2VpbmUgQmVyZWNodGlndW5nIGbDvHIgZGllc2VuIEJlZmVobC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHRlYW1fcm9sZXMgPSBbcm9sZSBmb3Igcm9sZSBpbiBtZW1iZXIucm9sZXMgaWYgcm9sZS5pZCBpbiBURUFNX1JPTEVfSURTXQogICAgaWYgbm90IHRlYW1fcm9sZXM6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIERpZXNlcyBNaXRnbGllZCBoYXQga2VpbmUgVGVhbXJvbGxlLicsIGVwaGVtZXJhbD1UcnVlKQogICAgZm9yIHJvbGUgaW4gdGVhbV9yb2xlczoKICAgICAgICBhd2FpdCBtZW1iZXIucmVtb3ZlX3JvbGVzKHJvbGUpCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndGVhbWtpY2snLCBtZW1iZXI9bWVtYmVyLm1lbnRpb24sIHJlYXNvbj1yZWFzb24sIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbikKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERlciBUZWFta2ljayB3dXJkZSBlcmZvbGdyZWljaCBkdXJjaGdlZsO8aHJ0IScsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgaW50ZXJhY3Rpb24uY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQogICAgYXdhaXQgc2VuZF9kbShtZW1iZXIsICdUZWFta2ljaycsIGYnRHUgd3VyZGVzdCBhdXMgZGVtIFRlYW0gZW50ZmVybnQuXG5cbioqR3J1bmQ6Kioge3JlYXNvbn0nLCBpbnRlcmFjdGlvbikKICAgIHVwZGF0ZV9oaXN0b3J5KG1lbWJlciwgJ1RlYW1raWNrJywgZidHcnVuZDoge3JlYXNvbn0gfCBEdXJjaGdlZsO8aHJ0IHZvbjoge2ludGVyYWN0aW9uLnVzZXIuZGlzcGxheV9uYW1lfScpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSd0ZWFtbWVtYmVyaGlzdG9yeScsIGRlc2NyaXB0aW9uPSdaZWlndCBkaWUgSGlzdG9yaWUgZWluZXMgVGVhbW1pdGdsaWVkcy4nKQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0nRGFzIE1pdGdsaWVkLCBkZXNzZW4gSGlzdG9yaWUgYW5nZXplaWd0IHdlcmRlbiBzb2xsLicpCmFzeW5jIGRlZiB0ZWFtbWVtYmVyaGlzdG9yeShpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlcik6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCdoaXN0b3J5Jyk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGlmIG5vdCBhbnkoKHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcykpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuJywgZXBoZW1lcmFsPVRydWUpCiAgICB1c2VyX2lkID0gc3RyKG1lbWJlci5pZCkKICAgIGlmIHVzZXJfaWQgbm90IGluIGhpc3Rvcnk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pqg77iPIEtlaW5lIEhpc3RvcmllIGbDvHIgZGllc2VzIE1pdGdsaWVkIGdlZnVuZGVuLicsIGVwaGVtZXJhbD1UcnVlKQogICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUubm93KCkudGltZXN0YW1wKCkKICAgIGZvciB3YXJuIGluIGhpc3RvcnlbdXNlcl9pZF0uZ2V0KCd3YXJucycsIFtdKToKICAgICAgICBpZiAnZXhwaXJlcycgaW4gd2FybjoKICAgICAgICAgICAgZXhwaXJlcyA9IGZsb2F0KHdhcm5bJ2V4cGlyZXMnXSkKICAgICAgICAgICAgd2FyblsnZXhwaXJlZCddID0gZXhwaXJlcyA8IGN1cnJlbnRfdGltZQogICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpCiAgICB1c2VyX2hpc3RvcnkgPSBoaXN0b3J5W3VzZXJfaWRdCiAgICBsYXN0X3VwcmFuayA9IHVzZXJfaGlzdG9yeS5nZXQoJ2xhc3RfdXByYW5rJywgJ04vQScpCiAgICB0b3RhbF93YXJucyA9IGxlbih1c2VyX2hpc3RvcnkuZ2V0KCd3YXJucycsIFtdKSkKICAgIGFjdGl2ZV93YXJucyA9IHN1bSgoMSBmb3Igd2FybiBpbiB1c2VyX2hpc3RvcnkuZ2V0KCd3YXJucycsIFtdKSBpZiBub3Qgd2Fybi5nZXQoJ2V4cGlyZWQnLCBGYWxzZSkpKQogICAgbGFzdF93YXJuX2V4cGlyZWQgPSAnTi9BJwogICAgZXhwaXJlZF93YXJucyA9IFt3IGZvciB3IGluIHVzZXJfaGlzdG9yeS5nZXQoJ3dhcm5zJywgW10pIGlmIHcuZ2V0KCdleHBpcmVkJywgRmFsc2UpXQogICAgaWYgZXhwaXJlZF93YXJuczoKICAgICAgICBsYXN0X2V4cGlyZSA9IG1heCgoZmxvYXQod1snZXhwaXJlcyddKSBmb3IgdyBpbiBleHBpcmVkX3dhcm5zKSkKICAgICAgICBsYXN0X3dhcm5fZXhwaXJlZCA9IGRhdGV0aW1lLmZyb210aW1lc3RhbXAobGFzdF9leHBpcmUpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICBjdXJyZW50X3JhbmsgPSBuZXh0KChyb2xlLm5hbWUgZm9yIHJvbGUgaW4gbWVtYmVyLnJvbGVzIGlmIHJvbGUuaWQgaW4gVEVBTV9ST0xFX0lEUyksICdOL0EnKQogICAgam9pbmVkX2F0ID0gdXNlcl9oaXN0b3J5LmdldCgnam9pbmVkX2F0JywgJ04vQScpCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9Zifwn5OcIEhpc3RvcmllIHZvbiB7bWVtYmVyLmRpc3BsYXlfbmFtZX0nLCBjb2xvcj1kaXNjb3JkLkNvbG9yLmJsdWUoKSkKICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdJbSBUZWFtIHNlaXQnLCB2YWx1ZT1qb2luZWRfYXQsIGlubGluZT1GYWxzZSkKICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdBa3R1ZWxsZXIgUmFuZycsIHZhbHVlPWN1cnJlbnRfcmFuaywgaW5saW5lPUZhbHNlKQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0xldHp0ZXIgVXByYW5rJywgdmFsdWU9bGFzdF91cHJhbmssIGlubGluZT1GYWxzZSkKICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdHZXNhbXRlIFdhcm51bmdlbicsIHZhbHVlPXN0cih0b3RhbF93YXJucyksIGlubGluZT1UcnVlKQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0FrdGl2ZSBXYXJudW5nZW4nLCB2YWx1ZT1zdHIoYWN0aXZlX3dhcm5zKSwgaW5saW5lPVRydWUpCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nTGV0enRlIGFiZ2VsYXVmZW5lIFdhcm51bmcnLCB2YWx1ZT1sYXN0X3dhcm5fZXhwaXJlZCwgaW5saW5lPUZhbHNlKQogICAgd2Fybl9kZXRhaWxzID0gW10KICAgIGZvciBpLCB3YXJuIGluIGVudW1lcmF0ZSh1c2VyX2hpc3RvcnkuZ2V0KCd3YXJucycsIFtdKSwgMSk6CiAgICAgICAgc3RhdHVzID0gJ/CflLQgQWt0aXYnIGlmIG5vdCB3YXJuLmdldCgnZXhwaXJlZCcsIEZhbHNlKSBlbHNlICfwn5+iIEFiZ2VsYXVmZW4nCiAgICAgICAgaXNzdWVkID0gd2Fybi5nZXQoJ2lzc3VlZCcsICdVbmJla2FubnQnKQogICAgICAgIGV4cGlyZXMgPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKGZsb2F0KHdhcm5bJ2V4cGlyZXMnXSkpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpIGlmICdleHBpcmVzJyBpbiB3YXJuIGVsc2UgJ1VuYmVrYW5udCcKICAgICAgICByZWFzb24gPSB3YXJuLmdldCgncmVhc29uJywgJ0tlaW4gR3J1bmQgYW5nZWdlYmVuJykKICAgICAgICB3YXJuX2RldGFpbHMuYXBwZW5kKGYne2l9LiB7c3RhdHVzfSB8IHtpc3N1ZWR9IGJpcyB7ZXhwaXJlc31cbkdydW5kOiB7cmVhc29ufVxuJykKICAgIGhpc3RvcnlfdGV4dCA9ICdcbicuam9pbih1c2VyX2hpc3RvcnkuZ2V0KCdmdWxsX2hpc3RvcnknLCBbJ0tlaW5lIEVpbnRyw6RnZSddKSkKICAgIHdhcm5fdGV4dCA9ICdcbicuam9pbih3YXJuX2RldGFpbHMpIGlmIHdhcm5fZGV0YWlscyBlbHNlICdLZWluZSBXYXJudW5nZW4nCiAgICBmdWxsX3RleHQgPSBmJz09PSBWT0xMU1TDhE5ESUdFIEhJU1RPUklFID09PVxue2hpc3RvcnlfdGV4dH1cblxuPT09IFdBUk5VTkdFTiA9PT1cbnt3YXJuX3RleHR9JwogICAgaGlzdG9yeV9maWxlID0gZGlzY29yZC5GaWxlKGlvLlN0cmluZ0lPKGZ1bGxfdGV4dCksIGZpbGVuYW1lPWYne21lbWJlci5kaXNwbGF5X25hbWV9X2hpc3RvcnkudHh0JykKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShlbWJlZD1lbWJlZCwgZmlsZT1oaXN0b3J5X2ZpbGUsIGVwaGVtZXJhbD1UcnVlKQpib3QucnVuKFRPS0VOKQ==').decode('utf-8'))