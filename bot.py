import base64; exec(base64.b64decode('aW1wb3J0IGRpc2NvcmQKZnJvbSBkaXNjb3JkIGltcG9ydCBhcHBfY29tbWFuZHMKZnJvbSBkaXNjb3JkLmV4dCBpbXBvcnQgY29tbWFuZHMKaW1wb3J0IGpzb24KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YSwgdGltZXpvbmUKaW1wb3J0IG9zCmltcG9ydCBhc3luY2lvCmltcG9ydCBpbwp3aXRoIG9wZW4oJ2NvbmZpZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgY29uZmlnID0ganNvbi5sb2FkKGYpClRPS0VOID0gY29uZmlnWydib3RfdG9rZW4nXQpHVUlMRF9JRCA9IGNvbmZpZ1snZ3VpbGRfaWQnXQpURUFNX1JPTEVfSURTID0gY29uZmlnWyd0ZWFtX3JvbGVfaWQnXQpBRE1JTl9ST0xFX0lEUyA9IGNvbmZpZ1snYWRtaW5fcm9sZV9pZCddCldBUk5fUk9MRVMgPSBjb25maWdbJ3dhcm5fcm9sZXMnXQpXQVJOX0ZJTEUgPSAnd2FybnMuanNvbicKSElTVE9SWV9GSUxFID0gJ21lbWJlcl9oaXN0b3J5Lmpzb24nCmludGVudHMgPSBkaXNjb3JkLkludGVudHMuYWxsKCkKYm90ID0gY29tbWFuZHMuQm90KGNvbW1hbmRfcHJlZml4PScvJywgaW50ZW50cz1pbnRlbnRzKQpsYXN0X21lc3NhZ2UgPSBOb25lCmxhc3RfY2hhbm5lbCA9IE5vbmUKCmRlZiBpc19mZWF0dXJlX2VuYWJsZWQoZmVhdHVyZTogc3RyKSAtPiBib29sOgogICAgcmV0dXJuIGNvbmZpZ1snZmVhdHVyZXMnXS5nZXQoZmVhdHVyZSwgVHJ1ZSkKCmRlZiBjcmVhdGVfZW1iZWQobmFtZTogc3RyLCAqKmt3YXJncykgLT4gZGlzY29yZC5FbWJlZDoKICAgIHNldHRpbmdzID0gY29uZmlnWydlbWJlZHMnXS5nZXQobmFtZSwge30pCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9c2V0dGluZ3MuZ2V0KCd0aXRsZScsICdLZWluIFRpdGVsJyksIGRlc2NyaXB0aW9uPXNldHRpbmdzLmdldCgnZGVzY3JpcHRpb24nLCAnJykuZm9ybWF0KCoqa3dhcmdzKSwgY29sb3I9ZGlzY29yZC5Db2xvcihzZXR0aW5ncy5nZXQoJ2NvbG9yJywgMzQ0NzAwMykpKQogICAgaWYgJ2F1dGhvcicgaW4gc2V0dGluZ3M6CiAgICAgICAgZW1iZWQuc2V0X2F1dGhvcihuYW1lPXNldHRpbmdzWydhdXRob3InXS5nZXQoJ25hbWUnLCAnJyksIGljb25fdXJsPXNldHRpbmdzWydhdXRob3InXS5nZXQoJ2ljb25fdXJsJywgJycpKQogICAgaWYgJ3RodW1ibmFpbCcgaW4gc2V0dGluZ3M6CiAgICAgICAgZW1iZWQuc2V0X3RodW1ibmFpbCh1cmw9c2V0dGluZ3NbJ3RodW1ibmFpbCddKQogICAgaWYgJ2Zvb3RlcicgaW4gc2V0dGluZ3M6CiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PXNldHRpbmdzWydmb290ZXInXS5nZXQoJ3RleHQnLCAnJyksIGljb25fdXJsPXNldHRpbmdzWydmb290ZXInXS5nZXQoJ2ljb25fdXJsJywgJycpKQogICAgaWYgc2V0dGluZ3MuZ2V0KCd0aW1lc3RhbXAnLCBGYWxzZSk6CiAgICAgICAgZW1iZWQudGltZXN0YW1wID0gZGF0ZXRpbWUubm93KHRpbWV6b25lLnV0YykKICAgIHJldHVybiBlbWJlZAoKZGVmIGxvYWRfd2FybnMoKToKICAgIGlmIG9zLnBhdGguZXhpc3RzKFdBUk5fRklMRSk6CiAgICAgICAgd2l0aCBvcGVuKFdBUk5fRklMRSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpCiAgICByZXR1cm4ge30KCmRlZiBzYXZlX3dhcm5zKCk6CiAgICB3aXRoIG9wZW4oV0FSTl9GSUxFLCAndycpIGFzIGY6CiAgICAgICAganNvbi5kdW1wKHdhcm5zLCBmLCBpbmRlbnQ9NCkKd2FybnMgPSBsb2FkX3dhcm5zKCkKCmRlZiBsb2FkX2hpc3RvcnkoKToKICAgIGlmIG9zLnBhdGguZXhpc3RzKEhJU1RPUllfRklMRSk6CiAgICAgICAgd2l0aCBvcGVuKEhJU1RPUllfRklMRSwgJ3InKSBhcyBmOgogICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpCiAgICByZXR1cm4ge30KCmRlZiBzYXZlX2hpc3RvcnkoaGlzdG9yeSk6CiAgICB3aXRoIG9wZW4oSElTVE9SWV9GSUxFLCAndycpIGFzIGY6CiAgICAgICAganNvbi5kdW1wKGhpc3RvcnksIGYsIGluZGVudD00KQoKZGVmIHVwZGF0ZV9oaXN0b3J5KG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIGFjdGlvbjogc3RyLCBkZXRhaWxzOiBzdHIpOgogICAgdXNlcl9pZCA9IHN0cihtZW1iZXIuaWQpCiAgICBpZiB1c2VyX2lkIG5vdCBpbiBoaXN0b3J5OgogICAgICAgIGhpc3RvcnlbdXNlcl9pZF0gPSB7J2pvaW5lZF9hdCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpLCAnbGFzdF91cHJhbmsnOiAnTi9BJywgJ3dhcm5zJzogW10sICdsYXN0X3dhcm5fZXhwaXJlZCc6ICdOL0EnLCAnZnVsbF9oaXN0b3J5JzogW119CiAgICBpZiBhY3Rpb24gPT0gJ1VwcmFuayc6CiAgICAgICAgaGlzdG9yeVt1c2VyX2lkXVsnbGFzdF91cHJhbmsnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICBlbGlmIGFjdGlvbiA9PSAnV2FybicgYW5kICdleHBpcmVkJyBpbiBkZXRhaWxzLmxvd2VyKCk6CiAgICAgICAgaGlzdG9yeVt1c2VyX2lkXVsnbGFzdF93YXJuX2V4cGlyZWQnXSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpCiAgICBoaXN0b3J5W3VzZXJfaWRdWydmdWxsX2hpc3RvcnknXS5hcHBlbmQoZidbe2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpfV0ge2FjdGlvbn06IHtkZXRhaWxzfScpCiAgICBzYXZlX2hpc3RvcnkoaGlzdG9yeSkKaGlzdG9yeSA9IGxvYWRfaGlzdG9yeSgpCgpAYm90LmV2ZW50CmFzeW5jIGRlZiBvbl9yZWFkeSgpOgogICAgcHJpbnQoZidCb3QgaXN0IG9ubGluZToge2JvdC51c2VyfSEnKQogICAgcHJpbnQoJ1NsYXNoLUNvbW1hbmRzIHdlcmRlbiBzeW5jaHJvbmlzaWVydC4uLicpCiAgICB0cnk6CiAgICAgICAgZ3VpbGQgPSBkaXNjb3JkLk9iamVjdChpZD1HVUlMRF9JRCkKICAgICAgICBhd2FpdCBib3QudHJlZS5zeW5jKCkKICAgICAgICBzeW5jZWQgPSBhd2FpdCBib3QudHJlZS5zeW5jKGd1aWxkPWd1aWxkKQogICAgICAgIHByaW50KGYnU3luY2VkIHtsZW4oc3luY2VkKX0gY29tbWFuZHMgZm9yIGd1aWxkIHtHVUlMRF9JRH0nKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYnRmVobGVyIGJlaW0gU3luY2hyb25pc2llcmVuOiB7ZX0nKQoKYXN5bmMgZGVmIHNlbmRfZG0obWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgdGl0bGU6IHN0ciwgZGVzY3JpcHRpb246IHN0ciwgaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24pOgogICAgdHJ5OgogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT10aXRsZSwgZGVzY3JpcHRpb249ZGVzY3JpcHRpb24sIGNvbG9yPWRpc2NvcmQuQ29sb3IuYmx1ZSgpKQogICAgICAgIGlmIGludGVyYWN0aW9uLmNoYW5uZWw6CiAgICAgICAgICAgIGxhc3RfbWVzc2FnZSA9IGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZCgnLicpCiAgICAgICAgICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdNZWhyIEluZm9zJywgdmFsdWU9ZidbTmFjaHJpY2h0IGFuemVpZ2VuXShodHRwczovL2Rpc2NvcmQuY29tL2NoYW5uZWxzL3tpbnRlcmFjdGlvbi5ndWlsZC5pZH0ve2ludGVyYWN0aW9uLmNoYW5uZWwuaWR9L3tsYXN0X21lc3NhZ2UuaWR9KScpCiAgICAgICAgICAgIGF3YWl0IGxhc3RfbWVzc2FnZS5kZWxldGUoKQogICAgICAgIGF3YWl0IG1lbWJlci5zZW5kKGVtYmVkPWVtYmVkKQogICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgIHByaW50KGYnW1dBUk5VTkddIEtvbm50ZSB7bWVtYmVyfSBrZWluZSBETSBzZW5kZW4gKERNcyBtw7ZnbGljaGVyd2Vpc2UgZGVha3RpdmllcnQpLicpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSd0ZWFtbGlzdGUnLCBkZXNjcmlwdGlvbj0nWmVpZ3QgZGllIFRlYW1taXRnbGllZGVyIHVuZCBpaHJlIFJvbGxlbi4nKQphc3luYyBkZWYgdGVhbWxpc3RlKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ3RlYW1saXN0ZScpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KchSBEaWUgVGVhbWxpc3RlIHdpcmQgYWt0dWFsaXNpZXJ0IScsIGVwaGVtZXJhbD1UcnVlKQogICAgYXdhaXQgdXBkYXRlX3RlYW1saXN0ZShpbnRlcmFjdGlvbi5jaGFubmVsKQoKYXN5bmMgZGVmIHVwZGF0ZV90ZWFtbGlzdGUoY2hhbm5lbCk6CiAgICBnbG9iYWwgbGFzdF9tZXNzYWdlLCBsYXN0X2NoYW5uZWwKICAgIHByaW50KGYnW0RFQlVHXSBTdGFydGluZyB0ZWFtIGxpc3QgdXBkYXRlIGluIGNoYW5uZWw6IHtjaGFubmVsLm5hbWV9JykKICAgIHRyeToKICAgICAgICBndWlsZCA9IGNoYW5uZWwuZ3VpbGQKICAgICAgICB0ZWFtX3JvbGVzID0ge30KICAgICAgICBmb3Igcm9sZV9pZCBpbiBURUFNX1JPTEVfSURTOgogICAgICAgICAgICByb2xlID0gZGlzY29yZC51dGlscy5nZXQoZ3VpbGQucm9sZXMsIGlkPWludChyb2xlX2lkKSkKICAgICAgICAgICAgaWYgcm9sZToKICAgICAgICAgICAgICAgIHRlYW1fcm9sZXNbcm9sZS5pZF0gPSByb2xlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmJ1tFUlJPUl0gVGVhbSByb2xlIHdpdGggSUQge3JvbGVfaWR9IG5vdCBmb3VuZCEnKQogICAgICAgIGlmIG5vdCB0ZWFtX3JvbGVzOgogICAgICAgICAgICBwcmludCgnW0VSUk9SXSBObyB2YWxpZCB0ZWFtIHJvbGVzIGZvdW5kIScpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIHRlYW1fbWVtYmVycyA9IHtyb2xlOiBbXSBmb3Igcm9sZSBpbiB0ZWFtX3JvbGVzLnZhbHVlcygpfQogICAgICAgIHRvdGFsX21lbWJlcnMgPSAwCiAgICAgICAgZm9yIG1lbWJlciBpbiBndWlsZC5tZW1iZXJzOgogICAgICAgICAgICBmb3Igcm9sZSBpbiBtZW1iZXIucm9sZXM6CiAgICAgICAgICAgICAgICBpZiByb2xlLmlkIGluIHRlYW1fcm9sZXM6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidbREVCVUddIEZvdW5kIHRlYW0gbWVtYmVyOiB7bWVtYmVyLmRpc3BsYXlfbmFtZX0gd2l0aCByb2xlOiB7cm9sZS5uYW1lfScpCiAgICAgICAgICAgICAgICAgICAgdGVhbV9tZW1iZXJzW3JvbGVdLmFwcGVuZChtZW1iZXIubWVudGlvbikKICAgICAgICAgICAgICAgICAgICB0b3RhbF9tZW1iZXJzICs9IDEKICAgICAgICBwcmludChmJ1tERUJVR10gRm91bmQge3RvdGFsX21lbWJlcnN9IHRlYW0gbWVtYmVycyBhY3Jvc3MgYWxsIHJvbGVzJykKICAgICAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndGVhbWxpc3RlJykKICAgICAgICBkZXNjcmlwdGlvbiA9ICcnCiAgICAgICAgZm9yIHJvbGUsIG1lbWJlcnMgaW4gdGVhbV9tZW1iZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIHJvbGVfbWVudGlvbiA9IHJvbGUubWVudGlvbgogICAgICAgICAgICBtZW1iZXJzX2xpc3QgPSAnXG4nLmpvaW4obWVtYmVycykgaWYgbWVtYmVycyBlbHNlICdLZWluZSBNaXRnbGllZGVyJwogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSBmJyoqe3JvbGVfbWVudGlvbn0qKiAoe2xlbihtZW1iZXJzKX0gTWl0Z2xpZWRlcilcbnttZW1iZXJzX2xpc3R9XG5cbicKICAgICAgICBlbWJlZC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uCiAgICAgICAgdGVhbWxpc3RlX3NldHRpbmdzID0gY29uZmlnWydlbWJlZHMnXS5nZXQoJ3RlYW1saXN0ZScsIHt9KQogICAgICAgIGlmICdpbWFnZScgaW4gdGVhbWxpc3RlX3NldHRpbmdzOgogICAgICAgICAgICBlbWJlZC5zZXRfaW1hZ2UodXJsPXRlYW1saXN0ZV9zZXR0aW5nc1snaW1hZ2UnXSkKICAgICAgICBpZiBsYXN0X21lc3NhZ2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IGxhc3RfbWVzc2FnZS5kZWxldGUoKQogICAgICAgICAgICBleGNlcHQgZGlzY29yZC5Ob3RGb3VuZDoKICAgICAgICAgICAgICAgIHByaW50KCdbREVCVUddIE9sZCBtZXNzYWdlIG5vdCBmb3VuZCAobWF5IGhhdmUgYmVlbiBkZWxldGVkIGFscmVhZHkpJykKICAgICAgICAgICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgICAgICAgICAgcHJpbnQoJ1tFUlJPUl0gQm90IGxhY2tzIHBlcm1pc3Npb25zIHRvIGRlbGV0ZSBtZXNzYWdlJykKICAgICAgICBsYXN0X21lc3NhZ2UgPSBhd2FpdCBjaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICAgICAgbGFzdF9jaGFubmVsID0gY2hhbm5lbAogICAgICAgIHByaW50KCdbREVCVUddIFRlYW0gbGlzdCBzdWNjZXNzZnVsbHkgdXBkYXRlZCEnKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYnW0VSUk9SXSBGYWlsZWQgdG8gdXBkYXRlIHRlYW0gbGlzdDoge3N0cihlKX0nKQogICAgICAgIHJhaXNlIGUKCkBib3QuZXZlbnQKYXN5bmMgZGVmIG9uX21lbWJlcl91cGRhdGUoYmVmb3JlOiBkaXNjb3JkLk1lbWJlciwgYWZ0ZXI6IGRpc2NvcmQuTWVtYmVyKToKICAgIGFkZGVkX3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gYWZ0ZXIucm9sZXMgaWYgcm9sZSBub3QgaW4gYmVmb3JlLnJvbGVzXQogICAgcmVtb3ZlZF9yb2xlcyA9IFtyb2xlIGZvciByb2xlIGluIGJlZm9yZS5yb2xlcyBpZiByb2xlIG5vdCBpbiBhZnRlci5yb2xlc10KICAgIHJlbGV2YW50X3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gYWRkZWRfcm9sZXMgKyByZW1vdmVkX3JvbGVzIGlmIHJvbGUuaWQgaW4gVEVBTV9ST0xFX0lEU10KICAgIGlmIHJlbGV2YW50X3JvbGVzIGFuZCBsYXN0X2NoYW5uZWw6CiAgICAgICAgYXdhaXQgdXBkYXRlX3RlYW1saXN0ZShsYXN0X2NoYW5uZWwpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSd0ZWFtYmVpdHJpdHQnLCBkZXNjcmlwdGlvbj0nRsO8Z3QgZWluZW4gVXNlciBpbiBkYXMgVGVhbSBlaW4uJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGJlaXRyZXRlbiBzb2xsLicsIHJvbGU9J0RpZSBzcGV6aWVsbGUgVGVhbXJvbGxlLCBkaWUgenVnZXdpZXNlbiB3aXJkLicpCmFzeW5jIGRlZiB0ZWFtYmVpdHJpdHQoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24sIG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIHJvbGU6IGRpc2NvcmQuUm9sZSk6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCd0ZWFtYmVpdHJpdHQnKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgRnVua3Rpb24gaXN0IGRlYWt0aXZpZXJ0LicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgbm90IGFueSgocm9sZS5pZCBpbiBBRE1JTl9ST0xFX0lEUyBmb3Igcm9sZSBpbiBpbnRlcmFjdGlvbi51c2VyLnJvbGVzKSk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIER1IGhhc3Qga2VpbmUgQmVyZWNodGlndW5nIGbDvHIgZGllc2VuIEJlZmVobC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGlmIHJvbGUuaWQgbm90IGluIFRFQU1fUk9MRV9JRFM6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIERpZXNlIFJvbGxlIGlzdCBrZWluZSBnw7xsdGlnZSBUZWFtcm9sbGUuJywgZXBoZW1lcmFsPVRydWUpCiAgICBzdGFuZGFyZF90ZWFtX3JvbGUgPSBkaXNjb3JkLnV0aWxzLmdldChpbnRlcmFjdGlvbi5ndWlsZC5yb2xlcywgaWQ9VEVBTV9ST0xFX0lEU1swXSkKICAgIGlmIG5vdCBzdGFuZGFyZF90ZWFtX3JvbGU6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIFN0YW5kYXJkLVRlYW1yb2xsZSB3dXJkZSBuaWNodCBnZWZ1bmRlbi4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMoc3RhbmRhcmRfdGVhbV9yb2xlLCByb2xlKQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoJ3RlYW1iZWl0cml0dCcsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgcm9sZT1yb2xlLm1lbnRpb24sIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbiwgYWRtaW5fcm9sZXM9JywgJy5qb2luKChmJzxAJntyb2xlX2lkfT4nIGZvciByb2xlX2lkIGluIEFETUlOX1JPTEVfSURTKSkpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KchSBEZXIgQmVpdHJpdHQgd3VyZGUgZXJmb2xncmVpY2ggdmVyYXJiZWl0ZXQhJywgZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICBhd2FpdCBzZW5kX2RtKG1lbWJlciwgJ1RlYW1iZWl0cml0dCcsIGYnV2lsbGtvbW1lbiBpbSBUZWFtIGFscyB7cm9sZS5uYW1lfS4gV2lyIGZyZXVlbiB1bnMgYXVmIGRpY2guJywgaW50ZXJhY3Rpb24pCiAgICB1cGRhdGVfaGlzdG9yeShtZW1iZXIsICdUZWFtYmVpdHJpdHQnLCBmJ0JlaWdldHJldGVuIG1pdCBSb2xsZSB7cm9sZS5uYW1lfSB8IEVpbmdlbGFkZW4gdm9uOiB7aW50ZXJhY3Rpb24udXNlci5kaXNwbGF5X25hbWV9JykKCkBib3QudHJlZS5jb21tYW5kKG5hbWU9J3VwcmFuaycsIGRlc2NyaXB0aW9uPSdCZWbDtnJkZXJ0IGVpbiBUZWFtbWl0Z2xpZWQuJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGFzIGJlZsO2cmRlcnQgd2lyZC4nLCBvbGRfcm9sZT0nQWx0ZSBSb2xsZScsIG5ld19yb2xlPSdOZXVlIFJvbGxlJykKYXN5bmMgZGVmIHVwcmFuayhpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgb2xkX3JvbGU6IGRpc2NvcmQuUm9sZSwgbmV3X3JvbGU6IGRpc2NvcmQuUm9sZSk6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCd1cHJhbmsnKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgRnVua3Rpb24gaXN0IGRlYWt0aXZpZXJ0LicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgbm90IGFueSgocm9sZS5pZCBpbiBBRE1JTl9ST0xFX0lEUyBmb3Igcm9sZSBpbiBpbnRlcmFjdGlvbi51c2VyLnJvbGVzKSk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIER1IGhhc3Qga2VpbmUgQmVyZWNodGlndW5nIGbDvHIgZGllc2VuIEJlZmVobC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGlmIG9sZF9yb2xlLmlkIG5vdCBpbiBURUFNX1JPTEVfSURTIG9yIG5ld19yb2xlLmlkIG5vdCBpbiBURUFNX1JPTEVfSURTOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBFaW5lIGRlciBSb2xsZW4gaXN0IGtlaW5lIGfDvGx0aWdlIFRlYW1yb2xsZS4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IG1lbWJlci5yZW1vdmVfcm9sZXMob2xkX3JvbGUpCiAgICBhd2FpdCBtZW1iZXIuYWRkX3JvbGVzKG5ld19yb2xlKQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoJ3VwcmFuaycsIG1lbWJlcj1tZW1iZXIubWVudGlvbiwgb2xkX3JvbGU9b2xkX3JvbGUubWVudGlvbiwgbmV3X3JvbGU9bmV3X3JvbGUubWVudGlvbiwgYWRtaW49aW50ZXJhY3Rpb24udXNlci5tZW50aW9uLCBhZG1pbl9yb2xlcz0nLCAnLmpvaW4oKGYnPEAme3JvbGVfaWR9PicgZm9yIHJvbGVfaWQgaW4gQURNSU5fUk9MRV9JRFMpKSkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4pyFIERlciBVcHJhbmsgd3VyZGUgZXJmb2xncmVpY2ggZHVyY2hnZWbDvGhydCEnLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIGF3YWl0IHNlbmRfZG0obWVtYmVyLCAnVXByYW5rJywgZidEdSBoYXN0IGVpbiAqKlVwcmFuayoqIHZvbiB7b2xkX3JvbGUubmFtZX0genUge25ld19yb2xlLm5hbWV9IGVyaGFsdGVuLicsIGludGVyYWN0aW9uKQogICAgaGlzdG9yeVtzdHIobWVtYmVyLmlkKV1bJ2xhc3RfdXByYW5rJ10gPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKQogICAgdXBkYXRlX2hpc3RvcnkobWVtYmVyLCAnVXByYW5rJywgZidCZWbDtnJkZXJ0IHZvbiB7b2xkX3JvbGUubmFtZX0genUge25ld19yb2xlLm5hbWV9IHwgRHVyY2g6IHtpbnRlcmFjdGlvbi51c2VyLmRpc3BsYXlfbmFtZX0nKQoKQGJvdC50cmVlLmNvbW1hbmQobmFtZT0nZGVyYW5rJywgZGVzY3JpcHRpb249J1NldHp0IGRpZSBUZWFtcm9sbGUgZWluZXMgTWl0Z2xpZWRzIGhlcmFiLicpCkBhcHBfY29tbWFuZHMuZGVzY3JpYmUobWVtYmVyPSdEYXMgTWl0Z2xpZWQsIGRhcyBkZWdyYWRpZXJ0IHdpcmQuJywgb2xkX3JvbGU9J0RpZSB2b3JoZXJpZ2UgUm9sbGUuJywgbmV3X3JvbGU9J0RpZSBuZXVlIFJvbGxlLicsIHJlYXNvbj0nRGVyIEdydW5kIGbDvHIgZGVuIERlcmFuay4nKQphc3luYyBkZWYgZGVyYW5rKGludGVyYWN0aW9uOiBkaXNjb3JkLkludGVyYWN0aW9uLCBtZW1iZXI6IGRpc2NvcmQuTWVtYmVyLCBvbGRfcm9sZTogZGlzY29yZC5Sb2xlLCBuZXdfcm9sZTogZGlzY29yZC5Sb2xlLCByZWFzb246IHN0cik6CiAgICBpZiBub3QgaXNfZmVhdHVyZV9lbmFibGVkKCdkZXJhbmsnKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgRnVua3Rpb24gaXN0IGRlYWt0aXZpZXJ0LicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgbm90IGFueSgocm9sZS5pZCBpbiBBRE1JTl9ST0xFX0lEUyBmb3Igcm9sZSBpbiBpbnRlcmFjdGlvbi51c2VyLnJvbGVzKSk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIER1IGhhc3Qga2VpbmUgQmVyZWNodGlndW5nIGbDvHIgZGllc2VuIEJlZmVobC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGlmIG9sZF9yb2xlLmlkIG5vdCBpbiBURUFNX1JPTEVfSURTIG9yIG5ld19yb2xlLmlkIG5vdCBpbiBURUFNX1JPTEVfSURTOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBFaW5lIG9kZXIgYmVpZGUgUm9sbGVuIHNpbmQga2VpbmUgZ8O8bHRpZ2VuIFRlYW1yb2xsZW4uJywgZXBoZW1lcmFsPVRydWUpCiAgICB0cnk6CiAgICAgICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhvbGRfcm9sZSkKICAgICAgICBhd2FpdCBtZW1iZXIuYWRkX3JvbGVzKG5ld19yb2xlKQogICAgZXhjZXB0IGRpc2NvcmQuRm9yYmlkZGVuOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBCb3QgaGF0IGtlaW5lIEJlcmVjaHRpZ3VuZywgUm9sbGVuIHp1IHZlcndhbHRlbi4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGV4Y2VwdCBkaXNjb3JkLkhUVFBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIEZlaGxlciBiZWltIEFrdHVhbGlzaWVyZW4gZGVyIFJvbGxlbi4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGVtYmVkID0gY3JlYXRlX2VtYmVkKCdkZXJhbmsnLCBtZW1iZXI9bWVtYmVyLm1lbnRpb24sIG9sZF9yb2xlPW9sZF9yb2xlLm1lbnRpb24sIG5ld19yb2xlPW5ld19yb2xlLm1lbnRpb24sIHJlYXNvbj1yZWFzb24sIGFkbWluPWludGVyYWN0aW9uLnVzZXIubWVudGlvbiwgYWRtaW5fcm9sZXM9JywgJy5qb2luKChmJzxAJntyb2xlX2lkfT4nIGZvciByb2xlX2lkIGluIEFETUlOX1JPTEVfSURTKSkpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KchSBEZXIgRGVyYW5rIHd1cmRlIGVyZm9sZ3JlaWNoIGR1cmNoZ2Vmw7xocnQhJywgZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICB0cnk6CiAgICAgICAgYXdhaXQgc2VuZF9kbShtZW1iZXIsICdEZXJhbmsnLCBmJ0R1IGhhc3QgZWluICoqRGVyYW5rKiogdm9uIHtvbGRfcm9sZS5uYW1lfSB6dSB7bmV3X3JvbGUubmFtZX0gZXJoYWx0ZW4uXG5cbioqR3J1bmQ6Kioge3JlYXNvbn0nLCBpbnRlcmFjdGlvbikKICAgIGV4Y2VwdCBkaXNjb3JkLkZvcmJpZGRlbjoKICAgICAgICBwcmludChmJ1tXQVJOVU5HXSBLb25udGUge21lbWJlcn0ga2VpbmUgRE0gc2VuZGVuIChETXMgbcO2Z2xpY2hlcndlaXNlIGRlYWt0aXZpZXJ0KS4nKQogICAgaWYgc3RyKG1lbWJlci5pZCkgbm90IGluIGhpc3Rvcnk6CiAgICAgICAgaGlzdG9yeVtzdHIobWVtYmVyLmlkKV0gPSB7J2pvaW5lZF9hdCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpLCAnbGFzdF91cHJhbmsnOiAnTi9BJywgJ3dhcm5zJzogW10sICdsYXN0X3dhcm5fZXhwaXJlZCc6ICdOL0EnLCAnZnVsbF9oaXN0b3J5JzogW119CiAgICBoaXN0b3J5W3N0cihtZW1iZXIuaWQpXVsnZnVsbF9oaXN0b3J5J10uYXBwZW5kKGYnW3tkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKX1dIERlcmFuazogVm9uIHtvbGRfcm9sZS5uYW1lfSB6dSB7bmV3X3JvbGUubmFtZX0gZHVyY2gge2ludGVyYWN0aW9uLnVzZXIuZGlzcGxheV9uYW1lfSwgR3J1bmQ6IHtyZWFzb259JykKICAgIHNhdmVfaGlzdG9yeShoaXN0b3J5KQoKQGJvdC50cmVlLmNvbW1hbmQobmFtZT0ndGVhbXdhcm4nLCBkZXNjcmlwdGlvbj0nR2lidCBlaW5lbSBUZWFtbWl0Z2xpZWQgZWluZSBXYXJudW5nLicpCkBhcHBfY29tbWFuZHMuZGVzY3JpYmUobWVtYmVyPSdEYXMgTWl0Z2xpZWQsIGRhcyBnZXdhcm50IHdpcmQuJywgcmVhc29uPSdHcnVuZCBmw7xyIGRpZSBXYXJudW5nLicsIGR1cmF0aW9uPSdEYXVlciBpbiBTZWt1bmRlbicpCmFzeW5jIGRlZiB0ZWFtd2FybihpbnRlcmFjdGlvbjogZGlzY29yZC5JbnRlcmFjdGlvbiwgbWVtYmVyOiBkaXNjb3JkLk1lbWJlciwgcmVhc29uOiBzdHIsIGR1cmF0aW9uOiBpbnQpOgogICAgaWYgbm90IGlzX2ZlYXR1cmVfZW5hYmxlZCgndGVhbXdhcm4nKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRGllc2UgRnVua3Rpb24gaXN0IGRlYWt0aXZpZXJ0LicsIGVwaGVtZXJhbD1UcnVlKQogICAgaWYgbm90IGFueSgocm9sZS5pZCBpbiBBRE1JTl9ST0xFX0lEUyBmb3Igcm9sZSBpbiBpbnRlcmFjdGlvbi51c2VyLnJvbGVzKSk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIER1IGhhc3Qga2VpbmUgQmVyZWNodGlndW5nIGbDvHIgZGllc2VuIEJlZmVobC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIHdhcm5faWQgPSBzdHIoaW50KGRhdGV0aW1lLm5vdygpLnRpbWVzdGFtcCgpKSkgKyBzdHIobWVtYmVyLmlkKQogICAgdXNlcl9pZCA9IHN0cihtZW1iZXIuaWQpCiAgICBpZiB1c2VyX2lkIG5vdCBpbiB3YXJuczoKICAgICAgICB3YXJuc1t1c2VyX2lkXSA9IFtdCiAgICB3YXJuc1t1c2VyX2lkXS5hcHBlbmQoeydpZCc6IHdhcm5faWQsICdyZWFzb24nOiByZWFzb24sICdleHBpcmVzJzogKGRhdGV0aW1lLm5vdygpICsgdGltZWRlbHRhKHNlY29uZHM9ZHVyYXRpb24pKS50aW1lc3RhbXAoKSwgJ2FkbWluJzogaW50ZXJhY3Rpb24udXNlci5pZH0pCiAgICBzYXZlX3dhcm5zKCkKICAgIHdhcm5fY291bnQgPSBsZW4oW3cgZm9yIHcgaW4gd2FybnMuZ2V0KHVzZXJfaWQsIFtdKSBpZiBub3Qgdy5nZXQoJ2V4cGlyZWQnLCBGYWxzZSldKQogICAgcm9sZV9pbmRleCA9ICh3YXJuX2NvdW50IC0gMSkgJSAzICsgMQogICAgZm9yIHJvbGVfaWQgaW4gY29uZmlnWyd3YXJuX3JvbGVzJ10udmFsdWVzKCk6CiAgICAgICAgcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1yb2xlX2lkKQogICAgICAgIGlmIHJvbGUgYW5kIHJvbGUgaW4gbWVtYmVyLnJvbGVzOgogICAgICAgICAgICBhd2FpdCBtZW1iZXIucmVtb3ZlX3JvbGVzKHJvbGUpCiAgICBuZXdfcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1jb25maWdbJ3dhcm5fcm9sZXMnXS5nZXQoc3RyKHJvbGVfaW5kZXgpKSkKICAgIGlmIG5ld19yb2xlOgogICAgICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMobmV3X3JvbGUpCiAgICBuZXdfcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1jb25maWdbJ3dhcm5fcm9sZXMnXS5nZXQoc3RyKHdhcm5fY291bnQpKSkKICAgIGlmIG5ld19yb2xlOgogICAgICAgIGF3YWl0IG1lbWJlci5hZGRfcm9sZXMobmV3X3JvbGUpCiAgICBlbWJlZCA9IGNyZWF0ZV9lbWJlZCgndGVhbXdhcm4nLCBtZW1iZXI9bWVtYmVyLm1lbnRpb24sIHJlYXNvbj1yZWFzb24sIGR1cmF0aW9uPWR1cmF0aW9uLCBhZG1pbj1pbnRlcmFjdGlvbi51c2VyLm1lbnRpb24sIGFkbWluX3JvbGVzPScsICcuam9pbigoZic8QCZ7cm9sZV9pZH0+JyBmb3Igcm9sZV9pZCBpbiBBRE1JTl9ST0xFX0lEUykpKQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2UuZGVmZXIoZXBoZW1lcmFsPVRydWUpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpCiAgICB0cnk6CiAgICAgICAgYXdhaXQgc2VuZF9kbShtZW1iZXIsICdUZWFtd2FybicsIGYnRHUgaGFzdCBlaW5lIFdhcm51bmcgZXJoYWx0ZW4uXG4qKkdydW5kOioqIHtyZWFzb259XG4qKkRhdWVyOioqIHtkdXJhdGlvbn1zXG4qKldhcm4tSUQ6Kioge3dhcm5faWR9JywgaW50ZXJhY3Rpb24pCiAgICBleGNlcHQgZGlzY29yZC5Gb3JiaWRkZW46CiAgICAgICAgcHJpbnQoZidLb25udGUgRE0gYW4ge21lbWJlcn0gbmljaHQgc2VuZGVuJykKICAgIGlmIHVzZXJfaWQgbm90IGluIGhpc3Rvcnk6CiAgICAgICAgaGlzdG9yeVt1c2VyX2lkXSA9IHsnam9pbmVkX2F0JzogZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJyksICd3YXJucyc6IFtdLCAnZnVsbF9oaXN0b3J5JzogW119CiAgICBoaXN0b3J5W3VzZXJfaWRdWyd3YXJucyddLmFwcGVuZCh7J2lkJzogd2Fybl9pZCwgJ3JlYXNvbic6IHJlYXNvbiwgJ2lzc3VlZCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclZC4lbS4lWSAlSDolTTolUycpLCAnZXhwaXJlcyc6IChkYXRldGltZS5ub3coKSArIHRpbWVkZWx0YShzZWNvbmRzPWR1cmF0aW9uKSkudGltZXN0YW1wKCksICdhZG1pbic6IGludGVyYWN0aW9uLnVzZXIuaWQsICdleHBpcmVkJzogRmFsc2V9KQogICAgc2F2ZV9oaXN0b3J5KGhpc3RvcnkpCgogICAgYXN5bmMgZGVmIGV4cGlyZV93YXJuKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKGR1cmF0aW9uKQogICAgICAgICAgICBpZiB1c2VyX2lkIG5vdCBpbiB3YXJuczoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB3YXJuX3N0aWxsX2FjdGl2ZSA9IEZhbHNlCiAgICAgICAgICAgIGZvciB3YXJuIGluIHdhcm5zW3VzZXJfaWRdOgogICAgICAgICAgICAgICAgaWYgd2FyblsnaWQnXSA9PSB3YXJuX2lkIGFuZCAobm90IHdhcm4uZ2V0KCdyZW1vdmVkJywgRmFsc2UpKToKICAgICAgICAgICAgICAgICAgICB3YXJuX3N0aWxsX2FjdGl2ZSA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBpZiBub3Qgd2Fybl9zdGlsbF9hY3RpdmU6CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgd2Fybl9sZXZlbCA9IE5vbmUKICAgICAgICAgICAgZm9yIGksIHdhcm4gaW4gZW51bWVyYXRlKHdhcm5zW3VzZXJfaWRdKToKICAgICAgICAgICAgICAgIGlmIHdhcm5bJ2lkJ10gPT0gd2Fybl9pZDoKICAgICAgICAgICAgICAgICAgICB3YXJuX2xldmVsID0gaSArIDEKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBpZiB3YXJuX2xldmVsIGFuZCB3YXJuX2xldmVsIDw9IDM6CiAgICAgICAgICAgICAgICByb2xlX2lkID0gY29uZmlnWyd3YXJuX3JvbGVzJ10uZ2V0KHN0cih3YXJuX2xldmVsKSkKICAgICAgICAgICAgICAgIGlmIHJvbGVfaWQ6CiAgICAgICAgICAgICAgICAgICAgcm9sZSA9IGRpc2NvcmQudXRpbHMuZ2V0KGludGVyYWN0aW9uLmd1aWxkLnJvbGVzLCBpZD1yb2xlX2lkKQogICAgICAgICAgICAgICAgICAgIGlmIHJvbGUgYW5kIHJvbGUgaW4gbWVtYmVyLnJvbGVzOgogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBtZW1iZXIucmVtb3ZlX3JvbGVzKHJvbGUpCiAgICAgICAgICAgIGZvciB3YXJuIGluIHdhcm5zW3VzZXJfaWRdOgogICAgICAgICAgICAgICAgaWYgd2FyblsnaWQnXSA9PSB3YXJuX2lkOgogICAgICAgICAgICAgICAgICAgIHdhcm5bJ2V4cGlyZWQnXSA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBzYXZlX3dhcm5zKCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgbWVtYmVyLnNlbmQoZW1iZWQ9ZGlzY29yZC5FbWJlZCh0aXRsZT0n4pyFIFdhcm51bmcgYWJnZWxhdWZlbicsIGRlc2NyaXB0aW9uPWYnRGVpbmUgV2FybnVuZyBpc3QgYXV0b21hdGlzY2ggYWJnZWxhdWZlbi5cblxuKipHcnVuZDoqKiB7cmVhc29ufVxuKipEYXVlcjoqKiB7ZHVyYXRpb259c1xuKipXYXJuLUlEOioqIHt3YXJuX2lkfScsIGNvbG9yPWRpc2NvcmQuQ29sb3IuZ3JlZW4oKSkpCiAgICAgICAgICAgIGV4Y2VwdCBkaXNjb3JkLkZvcmJpZGRlbjoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgbG9nX2NoYW5uZWxfaWQgPSBjb25maWcuZ2V0KCd3YXJuX2xvZ19jaGFubmVsJykKICAgICAgICAgICAgaWYgbG9nX2NoYW5uZWxfaWQ6CiAgICAgICAgICAgICAgICBsb2dfY2hhbm5lbCA9IGJvdC5nZXRfY2hhbm5lbChsb2dfY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgIGlmIGxvZ19jaGFubmVsOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvZ19jaGFubmVsLnNlbmQoZW1iZWQ9ZGlzY29yZC5FbWJlZCh0aXRsZT0n4pqg77iPIFdhcm51bmcgYWJnZWxhdWZlbicsIGRlc2NyaXB0aW9uPWYnV2FybnVuZyBmw7xyIHttZW1iZXIubWVudGlvbn0gaXN0IGFiZ2VsYXVmZW4nLCBjb2xvcj1kaXNjb3JkLkNvbG9yLmdyZWVuKCksIHRpbWVzdGFtcD1kYXRldGltZS5ub3coKSkuYWRkX2ZpZWxkKG5hbWU9J0dydW5kJywgdmFsdWU9cmVhc29uLCBpbmxpbmU9RmFsc2UpLmFkZF9maWVsZChuYW1lPSdEYXVlcicsIHZhbHVlPWYne2R1cmF0aW9ufSBTZWt1bmRlbicsIGlubGluZT1UcnVlKS5hZGRfZmllbGQobmFtZT0nV2Fybi1JRCcsIHZhbHVlPXdhcm5faWQsIGlubGluZT1UcnVlKS5zZXRfZm9vdGVyKHRleHQ9ZidBdXRvbWF0aXNjaCBhYmdlbGF1ZmVuJykpCiAgICAgICAgICAgIGlmIHVzZXJfaWQgaW4gaGlzdG9yeToKICAgICAgICAgICAgICAgIGZvciB3YXJuIGluIGhpc3RvcnlbdXNlcl9pZF1bJ3dhcm5zJ106CiAgICAgICAgICAgICAgICAgICAgaWYgd2Fybi5nZXQoJ2lkJykgPT0gd2Fybl9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgd2FyblsnZXhwaXJlZCddID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5W3VzZXJfaWRdWydsYXN0X3dhcm5fZXhwaXJlZCddID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkLiVtLiVZICVIOiVNOiVTJykKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHNhdmVfaGlzdG9yeShoaXN0b3J5KQogICAgICAgIGV4Y2VwdCBhc3luY2lvLkNhbmNlbGxlZEVycm9yOgogICAgICAgICAgICByZXR1cm4KICAgIGJvdC5sb29wLmNyZWF0ZV90YXNrKGV4cGlyZV93YXJuKCkpCgpAYm90LnRyZWUuY29tbWFuZChuYW1lPSd0ZWFta2ljaycsIGRlc2NyaXB0aW9uPSdFbnRmZXJudCBlaW4gVGVhbW1pdGdsaWVkIGF1cyBkZW0gVGVhbS4nKQpAYXBwX2NvbW1hbmRzLmRlc2NyaWJlKG1lbWJlcj0nRGFzIE1pdGdsaWVkLCBkYXMgZW50ZmVybnQgd2lyZC4nLCByZWFzb249J0dydW5kIGbDvHIgZGVuIEtpY2snKQphc3luYyBkZWYgdGVhbWtpY2soaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24sIG1lbWJlcjogZGlzY29yZC5NZW1iZXIsIHJlYXNvbjogc3RyKToKICAgIGlmIG5vdCBpc19mZWF0dXJlX2VuYWJsZWQoJ3RlYW1raWNrJyk6CiAgICAgICAgcmV0dXJuIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgn4p2MIERpZXNlIEZ1bmt0aW9uIGlzdCBkZWFrdGl2aWVydC4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGlmIG5vdCBhbnkoKHJvbGUuaWQgaW4gQURNSU5fUk9MRV9JRFMgZm9yIHJvbGUgaW4gaW50ZXJhY3Rpb24udXNlci5yb2xlcykpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEdSBoYXN0IGtlaW5lIEJlcmVjaHRpZ3VuZyBmw7xyIGRpZXNlbiBCZWZlaGwuJywgZXBoZW1lcmFsPVRydWUpCiAgICB0ZWFtX3JvbGVzID0gW3JvbGUgZm9yIHJvbGUgaW4gbWVtYmVyLnJvbGVzIGlmIHJvbGUuaWQgaW4gVEVBTV9ST0xFX0lEU10KICAgIGlmIG5vdCB0ZWFtX3JvbGVzOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZXMgTWl0Z2xpZWQgaGF0IGtlaW5lIFRlYW1yb2xsZS4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGZvciByb2xlIGluIHRlYW1fcm9sZXM6CiAgICAgICAgYXdhaXQgbWVtYmVyLnJlbW92ZV9yb2xlcyhyb2xlKQogICAgZW1iZWQgPSBjcmVhdGVfZW1iZWQoJ3RlYW1raWNrJywgbWVtYmVyPW1lbWJlci5tZW50aW9uLCByZWFzb249cmVhc29uLCBhZG1pbj1pbnRlcmFjdGlvbi51c2VyLm1lbnRpb24pCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KchSBEZXIgVGVhbWtpY2sgd3VyZGUgZXJmb2xncmVpY2ggZHVyY2hnZWbDvGhydCEnLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGF3YWl0IGludGVyYWN0aW9uLmNoYW5uZWwuc2VuZChlbWJlZD1lbWJlZCkKICAgIGF3YWl0IHNlbmRfZG0obWVtYmVyLCAnVGVhbWtpY2snLCBmJ0R1IHd1cmRlc3QgYXVzIGRlbSBUZWFtIGVudGZlcm50LlxuXG4qKkdydW5kOioqIHtyZWFzb259JywgaW50ZXJhY3Rpb24pCiAgICB1cGRhdGVfaGlzdG9yeShtZW1iZXIsICdUZWFta2ljaycsIGYnR3J1bmQ6IHtyZWFzb259IHwgRHVyY2hnZWbDvGhydCB2b246IHtpbnRlcmFjdGlvbi51c2VyLmRpc3BsYXlfbmFtZX0nKQoKQGJvdC50cmVlLmNvbW1hbmQobmFtZT0ndGVhbW1lbWJlcmhpc3RvcnknLCBkZXNjcmlwdGlvbj0nWmVpZ3QgZGllIEhpc3RvcmllIGVpbmVzIFRlYW1taXRnbGllZHMuJykKQGFwcF9jb21tYW5kcy5kZXNjcmliZShtZW1iZXI9J0RhcyBNaXRnbGllZCwgZGVzc2VuIEhpc3RvcmllIGFuZ2V6ZWlndCB3ZXJkZW4gc29sbC4nKQphc3luYyBkZWYgdGVhbW1lbWJlcmhpc3RvcnkoaW50ZXJhY3Rpb246IGRpc2NvcmQuSW50ZXJhY3Rpb24sIG1lbWJlcjogZGlzY29yZC5NZW1iZXIpOgogICAgaWYgbm90IGlzX2ZlYXR1cmVfZW5hYmxlZCgnaGlzdG9yeScpOgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KdjCBEaWVzZSBGdW5rdGlvbiBpc3QgZGVha3RpdmllcnQuJywgZXBoZW1lcmFsPVRydWUpCiAgICBpZiBub3QgYW55KChyb2xlLmlkIGluIEFETUlOX1JPTEVfSURTIGZvciByb2xlIGluIGludGVyYWN0aW9uLnVzZXIucm9sZXMpKToKICAgICAgICByZXR1cm4gYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCfinYwgRHUgaGFzdCBrZWluZSBCZXJlY2h0aWd1bmcgZsO8ciBkaWVzZW4gQmVmZWhsLicsIGVwaGVtZXJhbD1UcnVlKQogICAgdXNlcl9pZCA9IHN0cihtZW1iZXIuaWQpCiAgICBpZiB1c2VyX2lkIG5vdCBpbiBoaXN0b3J5OgogICAgICAgIHJldHVybiBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoJ+KaoO+4jyBLZWluZSBIaXN0b3JpZSBmw7xyIGRpZXNlcyBNaXRnbGllZCBnZWZ1bmRlbi4nLCBlcGhlbWVyYWw9VHJ1ZSkKICAgIGN1cnJlbnRfdGltZSA9IGRhdGV0aW1lLm5vdygpLnRpbWVzdGFtcCgpCiAgICBmb3Igd2FybiBpbiBoaXN0b3J5W3VzZXJfaWRdLmdldCgnd2FybnMnLCBbXSk6CiAgICAgICAgaWYgJ2V4cGlyZXMnIGluIHdhcm46CiAgICAgICAgICAgIGV4cGlyZXMgPSBmbG9hdCh3YXJuWydleHBpcmVzJ10pCiAgICAgICAgICAgIHdhcm5bJ2V4cGlyZWQnXSA9IGV4cGlyZXMgPCBjdXJyZW50X3RpbWUKICAgIHNhdmVfaGlzdG9yeShoaXN0b3J5KQogICAgdXNlcl9oaXN0b3J5ID0gaGlzdG9yeVt1c2VyX2lkXQogICAgbGFzdF91cHJhbmsgPSB1c2VyX2hpc3RvcnkuZ2V0KCdsYXN0X3VwcmFuaycsICdOL0EnKQogICAgdG90YWxfd2FybnMgPSBsZW4odXNlcl9oaXN0b3J5LmdldCgnd2FybnMnLCBbXSkpCiAgICBhY3RpdmVfd2FybnMgPSBzdW0oKDEgZm9yIHdhcm4gaW4gdXNlcl9oaXN0b3J5LmdldCgnd2FybnMnLCBbXSkgaWYgbm90IHdhcm4uZ2V0KCdleHBpcmVkJywgRmFsc2UpKSkKICAgIGxhc3Rfd2Fybl9leHBpcmVkID0gJ04vQScKICAgIGV4cGlyZWRfd2FybnMgPSBbdyBmb3IgdyBpbiB1c2VyX2hpc3RvcnkuZ2V0KCd3YXJucycsIFtdKSBpZiB3LmdldCgnZXhwaXJlZCcsIEZhbHNlKV0KICAgIGlmIGV4cGlyZWRfd2FybnM6CiAgICAgICAgbGFzdF9leHBpcmUgPSBtYXgoKGZsb2F0KHdbJ2V4cGlyZXMnXSkgZm9yIHcgaW4gZXhwaXJlZF93YXJucykpCiAgICAgICAgbGFzdF93YXJuX2V4cGlyZWQgPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKGxhc3RfZXhwaXJlKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKQogICAgY3VycmVudF9yYW5rID0gbmV4dCgocm9sZS5uYW1lIGZvciByb2xlIGluIG1lbWJlci5yb2xlcyBpZiByb2xlLmlkIGluIFRFQU1fUk9MRV9JRFMpLCAnTi9BJykKICAgIGpvaW5lZF9hdCA9IHVzZXJfaGlzdG9yeS5nZXQoJ2pvaW5lZF9hdCcsICdOL0EnKQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPWYn8J+TnCBIaXN0b3JpZSB2b24ge21lbWJlci5kaXNwbGF5X25hbWV9JywgY29sb3I9ZGlzY29yZC5Db2xvci5ibHVlKCkpCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nSW0gVGVhbSBzZWl0JywgdmFsdWU9am9pbmVkX2F0LCBpbmxpbmU9RmFsc2UpCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nQWt0dWVsbGVyIFJhbmcnLCB2YWx1ZT1jdXJyZW50X3JhbmssIGlubGluZT1GYWxzZSkKICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdMZXR6dGVyIFVwcmFuaycsIHZhbHVlPWxhc3RfdXByYW5rLCBpbmxpbmU9RmFsc2UpCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nR2VzYW10ZSBXYXJudW5nZW4nLCB2YWx1ZT1zdHIodG90YWxfd2FybnMpLCBpbmxpbmU9VHJ1ZSkKICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdBa3RpdmUgV2FybnVuZ2VuJywgdmFsdWU9c3RyKGFjdGl2ZV93YXJucyksIGlubGluZT1UcnVlKQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0xldHp0ZSBhYmdlbGF1ZmVuZSBXYXJudW5nJywgdmFsdWU9bGFzdF93YXJuX2V4cGlyZWQsIGlubGluZT1GYWxzZSkKICAgIHdhcm5fZGV0YWlscyA9IFtdCiAgICBmb3IgaSwgd2FybiBpbiBlbnVtZXJhdGUodXNlcl9oaXN0b3J5LmdldCgnd2FybnMnLCBbXSksIDEpOgogICAgICAgIHN0YXR1cyA9ICfwn5S0IEFrdGl2JyBpZiBub3Qgd2Fybi5nZXQoJ2V4cGlyZWQnLCBGYWxzZSkgZWxzZSAn8J+foiBBYmdlbGF1ZmVuJwogICAgICAgIGlzc3VlZCA9IHdhcm4uZ2V0KCdpc3N1ZWQnLCAnVW5iZWthbm50JykKICAgICAgICBleHBpcmVzID0gZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChmbG9hdCh3YXJuWydleHBpcmVzJ10pKS5zdHJmdGltZSgnJWQuJW0uJVkgJUg6JU06JVMnKSBpZiAnZXhwaXJlcycgaW4gd2FybiBlbHNlICdVbmJla2FubnQnCiAgICAgICAgcmVhc29uID0gd2Fybi5nZXQoJ3JlYXNvbicsICdLZWluIEdydW5kIGFuZ2VnZWJlbicpCiAgICAgICAgd2Fybl9kZXRhaWxzLmFwcGVuZChmJ3tpfS4ge3N0YXR1c30gfCB7aXNzdWVkfSBiaXMge2V4cGlyZXN9XG5HcnVuZDoge3JlYXNvbn1cbicpCiAgICBoaXN0b3J5X3RleHQgPSAnXG4nLmpvaW4odXNlcl9oaXN0b3J5LmdldCgnZnVsbF9oaXN0b3J5JywgWydLZWluZSBFaW50csOkZ2UnXSkpCiAgICB3YXJuX3RleHQgPSAnXG4nLmpvaW4od2Fybl9kZXRhaWxzKSBpZiB3YXJuX2RldGFpbHMgZWxzZSAnS2VpbmUgV2FybnVuZ2VuJwogICAgZnVsbF90ZXh0ID0gZic9PT0gVk9MTFNUw4RORElHRSBISVNUT1JJRSA9PT1cbntoaXN0b3J5X3RleHR9XG5cbj09PSBXQVJOVU5HRU4gPT09XG57d2Fybl90ZXh0fScKICAgIGhpc3RvcnlfZmlsZSA9IGRpc2NvcmQuRmlsZShpby5TdHJpbmdJTyhmdWxsX3RleHQpLCBmaWxlbmFtZT1mJ3ttZW1iZXIuZGlzcGxheV9uYW1lfV9oaXN0b3J5LnR4dCcpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoZW1iZWQ9ZW1iZWQsIGZpbGU9aGlzdG9yeV9maWxlLCBlcGhlbWVyYWw9VHJ1ZSkKYm90LnJ1bihUT0tFTik=').decode('utf-8'))